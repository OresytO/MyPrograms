<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Spring Web Flow 2 Reference Guide</title><link rel="stylesheet" href="css/stylesheet.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Spring Web Flow 2 Reference Guide</h1></div><div><h2 class="subtitle">Reference Documentation</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Keith</span> <span class="surname">Donald</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Erwin</span> <span class="surname">Vervaet</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Jeremy</span> <span class="surname">Grelle</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Scott</span> <span class="surname">Andrews</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Rossen</span> <span class="surname">Stoyanchev</span></h3></div></div></div><div><p class="releaseinfo">Version 2.0.3</p></div><div><div class="legalnotice"><a name="d0e37"></a><p>
				Copies of this document may be made for your own use and for
				distribution to others, provided that you do not charge any
				fee for such copies and further provided that each copy
				contains this Copyright Notice, whether distributed in print
				or electronically.
			</p></div></div><div><p class="pubdate">July 2008</p></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="sect1"><a href="#manual-overview">1.1. What this guide covers</a></span></dt><dt><span class="sect1"><a href="#system-requirements">1.2. What Web Flow requires to run</a></span></dt><dt><span class="sect1"><a href="#support">1.3. Where to get support</a></span></dt><dt><span class="sect1"><a href="#development">1.4. Where to follow development</a></span></dt><dt><span class="sect1"><a href="#jars">1.5. How to obtain Web Flow artifacts from the SpringSource Bundle Repository</a></span></dt><dd><dl><dt><span class="sect2"><a href="#jars-maven">1.5.1. Accessing Web Flow with Maven</a></span></dt><dt><span class="sect2"><a href="#jars-ivy">1.5.2. Accessing Web Flow with Ivy</a></span></dt></dl></dd><dt><span class="sect1"><a href="#jars-mvn-central">1.6. How to obtain Web Flow artifacts from Maven Central</a></span></dt><dt><span class="sect1"><a href="#d0e148">1.7. How to Obtain Nightly Builds</a></span></dt></dl></dd><dt><span class="chapter"><a href="#defining-flows">2. Defining Flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#defining-flows-introduction">2.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-overview">2.2. What is a flow?</a></span></dt><dt><span class="sect1"><a href="#flow-makeup">2.3. What is the makeup of a typical flow?</a></span></dt><dt><span class="sect1"><a href="#flow-authoring">2.4. How are flows authored?</a></span></dt><dt><span class="sect1"><a href="#essential-flow-elements">2.5. Essential language elements</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-element">2.5.1. flow</a></span></dt><dt><span class="sect2"><a href="#view-state-element">2.5.2. view-state</a></span></dt><dt><span class="sect2"><a href="#transition-element">2.5.3. transition</a></span></dt><dt><span class="sect2"><a href="#end-state-element">2.5.4. end-state</a></span></dt><dt><span class="sect2"><a href="#checkpoint-essential-language-elements">2.5.5. Checkpoint: Essential language elements</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-actions">2.6. Actions</a></span></dt><dd><dl><dt><span class="sect2"><a href="#evaluate-element">2.6.1. evaluate</a></span></dt><dd><dl><dt><span class="sect3"><a href="#evaluate-element-result">2.6.1.1. Assigning an evaluate result</a></span></dt><dt><span class="sect3"><a href="#evaluate-element-result-type">2.6.1.2. Converting an evaluate result</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-actions">2.6.2. Checkpoint: flow actions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-inputoutput">2.7. Input/Output Mapping</a></span></dt><dd><dl><dt><span class="sect2"><a href="#input-element">2.7.1. input</a></span></dt><dd><dl><dt><span class="sect3"><a href="#input-element-type">2.7.1.1. Declaring an input type</a></span></dt><dt><span class="sect3"><a href="#input-element-value">2.7.1.2. Assigning an input value</a></span></dt><dt><span class="sect3"><a href="#input-element-required">2.7.1.3. Marking an input as required</a></span></dt></dl></dd><dt><span class="sect2"><a href="#output-element">2.7.2. output</a></span></dt><dd><dl><dt><span class="sect3"><a href="#output-element-value">2.7.2.1. Specifying the source of an output value</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-input-output">2.7.3. Checkpoint: input/output mapping</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-variables">2.8. Variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#var-element">2.8.1. var</a></span></dt></dl></dd><dt><span class="sect1"><a href="#calling-subflows">2.9. Calling subflows</a></span></dt><dd><dl><dt><span class="sect2"><a href="#subflow-state-element">2.9.1. subflow-state</a></span></dt><dd><dl><dt><span class="sect3"><a href="#subflow-state-element-input">2.9.1.1. Passing a subflow input</a></span></dt><dt><span class="sect3"><a href="#subflow-state-element-output">2.9.1.2. Mapping subflow output</a></span></dt></dl></dd><dt><span class="sect2"><a href="#checkpoint-subflow">2.9.2. Checkpoint: calling subflows</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#el">3. Expression Language (EL)</a></span></dt><dd><dl><dt><span class="sect1"><a href="#el-introduction">3.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#el-language-choices">3.2. Supported EL implementations</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-unified-el">3.2.1. Unified EL</a></span></dt><dt><span class="sect2"><a href="#el-ognl">3.2.2. OGNL</a></span></dt></dl></dd><dt><span class="sect1"><a href="#el-portability">3.3. EL portability</a></span></dt><dt><span class="sect1"><a href="#el-usage">3.4. EL usage</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-types">3.4.1. Expression types</a></span></dt><dd><dl><dt><span class="sect3"><a href="#el-types-eval">3.4.1.1. Standard eval expressions</a></span></dt><dt><span class="sect3"><a href="#el-types-template">3.4.1.2. Template expressions</a></span></dt></dl></dd></dl></dd><dt><span class="sect1"><a href="#el-variables">3.5. Special EL variables</a></span></dt><dd><dl><dt><span class="sect2"><a href="#el-variable-flowScope">3.5.1. flowScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-viewScope">3.5.2. viewScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestScope">3.5.3. requestScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-flashScope">3.5.4. flashScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-conversationScope">3.5.5. conversationScope</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestParameters">3.5.6. requestParameters</a></span></dt><dt><span class="sect2"><a href="#el-variable-currentEvent">3.5.7. currentEvent</a></span></dt><dt><span class="sect2"><a href="#el-variable-currentUser">3.5.8. currentUser</a></span></dt><dt><span class="sect2"><a href="#el-variable-messageContext">3.5.9. messageContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-resourceBundle">3.5.10. resourceBundle</a></span></dt><dt><span class="sect2"><a href="#el-variable-requestContext">3.5.11. flowRequestContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-flowExecutionContext">3.5.12. flowExecutionContext</a></span></dt><dt><span class="sect2"><a href="#el-variable-flowExecutionUrl">3.5.13. flowExecutionUrl</a></span></dt><dt><span class="sect2"><a href="#el-variable-externalContext">3.5.14. externalContext</a></span></dt></dl></dd><dt><span class="sect1"><a href="#el-scope-searching">3.6. Scope searching algorithm</a></span></dt></dl></dd><dt><span class="chapter"><a href="#views">4. Rendering views</a></span></dt><dd><dl><dt><span class="sect1"><a href="#views-introduction">4.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#view-convention">4.2. Defining view states</a></span></dt><dt><span class="sect1"><a href="#view-explicit">4.3. Specifying view identifiers</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-explicit-flowrelative">4.3.1. Flow relative view ids</a></span></dt><dt><span class="sect2"><a href="#view-explicit-absolute">4.3.2. Absolute view ids</a></span></dt><dt><span class="sect2"><a href="#view-explicit-logical">4.3.3. Logical view ids</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-scope">4.4. View scope</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-scope-var">4.4.1. Allocating view variables</a></span></dt><dt><span class="sect2"><a href="#view-scope-actions">4.4.2. Assigning a viewScope variable</a></span></dt><dt><span class="sect2"><a href="#view-scope-ajax">4.4.3. Manipulating objects in view scope</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-on-render">4.5. Executing render actions</a></span></dt><dt><span class="sect1"><a href="#view-model">4.6. Binding to a model</a></span></dt><dt><span class="sect1"><a href="#view-bind">4.7. Suppressing binding</a></span></dt><dt><span class="sect1"><a href="#view-binder">4.8. Specifying bindings explicitly</a></span></dt><dt><span class="sect1"><a href="#view-validate">4.9. Validating a model</a></span></dt><dd><dl><dt><span class="sect2"><a href="#view-validation-programmatic">4.9.1. Programmatic validation</a></span></dt><dd><dl><dt><span class="sect3"><a href="#view-validation=programmatic-validate-method">4.9.1.1. Implementing a model validate method</a></span></dt><dt><span class="sect3"><a href="#view-validation=programmatic-validator">4.9.1.2. Implementing a Validator</a></span></dt></dl></dd><dt><span class="sect2"><a href="#view-validation-declarative">4.9.2. Declarative validation</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-validation-suppression">4.10. Suppressing validation</a></span></dt><dt><span class="sect1"><a href="#transition-actions">4.11. Transition actions</a></span></dt><dt><span class="sect1"><a href="#simple-event-handlers">4.12. Handling events</a></span></dt><dd><dl><dt><span class="sect2"><a href="#event-handlers-render">4.12.1. Rendering partials</a></span></dt><dt><span class="sect2"><a href="#event-handlers-global">4.12.2. Handling global events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-messages">4.13. Working with messages</a></span></dt><dd><dl><dt><span class="sect2"><a href="#plain-text-message">4.13.1. Adding plain text messages</a></span></dt><dt><span class="sect2"><a href="#plain-text-message-intl">4.13.2. Adding internationalized messages</a></span></dt><dt><span class="sect2"><a href="#message-bundles">4.13.3. Using message bundles</a></span></dt></dl></dd><dt><span class="sect1"><a href="#view-popup">4.14. Displaying popups</a></span></dt><dt><span class="sect1"><a href="#view-backtracking">4.15. View backtracking</a></span></dt><dd><dl><dt><span class="sect2"><a href="#history-discard">4.15.1. Discarding history</a></span></dt><dt><span class="sect2"><a href="#history-invalidate">4.15.2. Invalidating history</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#actions">5. Executing actions</a></span></dt><dd><dl><dt><span class="sect1"><a href="#actions-introduction">5.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#action-state">5.2. Defining action states</a></span></dt><dt><span class="sect1"><a href="#decision-state">5.3. Defining decision states</a></span></dt><dt><span class="sect1"><a href="#action-outcome-events">5.4. Action outcome event mappings</a></span></dt><dt><span class="sect1"><a href="#action-examples">5.5. Action execution examples</a></span></dt><dd><dl><dt><span class="sect2"><a href="#action-on-start">5.5.1. on-start</a></span></dt><dt><span class="sect2"><a href="#action-on-state-entry">5.5.2. on-entry</a></span></dt><dt><span class="sect2"><a href="#action-on-state-exit">5.5.3. on-exit</a></span></dt><dt><span class="sect2"><a href="#on-end">5.5.4. on-end</a></span></dt><dt><span class="sect2"><a href="#action-on-render">5.5.5. on-render</a></span></dt><dt><span class="sect2"><a href="#action-on-transition">5.5.6. on-transition</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#flow-managed-persistence">6. Flow Managed Persistence</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-managed-persistence-introduction">6.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-managed-data-access-patterns">6.2. Data access patterns</a></span></dt><dt><span class="sect1"><a href="#flowScopedPersistenceContext">6.3. FlowScoped PersistenceContext</a></span></dt><dt><span class="sect1"><a href="#conversationScopedPersistenceContext">6.4. ConversationScoped PersistenceContext</a></span></dt><dt><span class="sect1"><a href="#viewScopedPersistenceContext">6.5. ViewState PersistenceContext</a></span></dt></dl></dd><dt><span class="chapter"><a href="#flow-security">7. Securing Flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-security-introduction">7.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-security-how-to">7.2. How do I secure a flow?</a></span></dt><dt><span class="sect1"><a href="#flow-security-secured-element">7.3. The secured element</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-secured-element-attributes">7.3.1. Security attributes</a></span></dt><dt><span class="sect2"><a href="#flow-security-secured-element-match">7.3.2. Matching type</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-security-listener">7.4. The SecurityFlowExecutionListener</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-listener-adm">7.4.1. Custom Access Decision Managers</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-security-configuration">7.5. Configuring Spring Security</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-security-configuration-spring">7.5.1. Spring configuration</a></span></dt><dt><span class="sect2"><a href="#flow-security-configuration-web">7.5.2. web.xml Configuration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#flow-inheritance">8. Flow Inheritance</a></span></dt><dd><dl><dt><span class="sect1"><a href="#flow-inheritance-introduction">8.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-java-comparison">8.2. Is flow inheritance like Java inheritance?</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-levels">8.3. Types of Flow Inheritance</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-inheritance-level-flow">8.3.1. Flow level inheritance</a></span></dt><dt><span class="sect2"><a href="#flow-inheritance-level-state">8.3.2. State level inheritance</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-inheritance-abstract">8.4. Abstract flows</a></span></dt><dt><span class="sect1"><a href="#flow-inheritance-algorithm">8.5. Inheritance Algorithm</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-inheritance-algorithm-mergeable">8.5.1. Mergeable Elements</a></span></dt><dt><span class="sect2"><a href="#flow-inheritance-nonmergeable">8.5.2. Non-mergeable Elements</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#system-setup">9. System Setup</a></span></dt><dd><dl><dt><span class="sect1"><a href="#system-setup-introduction">9.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#system-config-schema">9.2. webflow-config.xsd</a></span></dt><dt><span class="sect1"><a href="#system-config-basic">9.3. Basic system configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#basic-setup-flow-registry">9.3.1. FlowRegistry</a></span></dt><dt><span class="sect2"><a href="#basic-setup-flow-executor">9.3.2. FlowExecutor</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-registry">9.4. flow-registry options</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-registry-builder-services">9.4.1. Configuring custom FlowBuilder services</a></span></dt><dd><dl><dt><span class="sect3"><a href="#builder-service-conversion">9.4.1.1. conversion-service</a></span></dt><dt><span class="sect3"><a href="#builder-service-expression-parser">9.4.1.2. expression-parser</a></span></dt><dt><span class="sect3"><a href="#builder-service-view-factory-creator">9.4.1.3. view-factory-creator</a></span></dt></dl></dd><dt><span class="sect2"><a href="#flow-registry-parent">9.4.2. Configuring FlowRegistry hierarchies</a></span></dt><dt><span class="sect2"><a href="#flow-registry-location">9.4.3. Specifying flow locations</a></span></dt><dt><span class="sect2"><a href="#flow-registry-location-id">9.4.4. Assigning custom flow identifiers</a></span></dt><dt><span class="sect2"><a href="#flow-registry-location-attributes">9.4.5. Assigning flow meta-attributes</a></span></dt><dt><span class="sect2"><a href="#flow-registry-patterns">9.4.6. Registering flows using a location pattern</a></span></dt></dl></dd><dt><span class="sect1"><a href="#flow-executor">9.5. flow-executor options</a></span></dt><dd><dl><dt><span class="sect2"><a href="#flow-executor-execution-listeners">9.5.1. Attaching flow execution listeners</a></span></dt><dt><span class="sect2"><a href="#tuning-flow-execution-repository">9.5.2. Tuning FlowExecution persistence</a></span></dt><dd><dl><dt><span class="sect3"><a href="#repository-max-executions">9.5.2.1. max-executions</a></span></dt><dt><span class="sect3"><a href="#repository-max-snapshots">9.5.2.2. max-execution-snapshots</a></span></dt></dl></dd></dl></dd></dl></dd><dt><span class="chapter"><a href="#spring-mvc">10. Spring MVC Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-mvc-introduction">10.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-web.xml">10.2. Configuring web.xml</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-spring-url-mapping">10.3. Mapping URLs to Flows</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-flow-handlers">10.4. Flow Handlers</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-mvc-flow-handler-example">10.4.1. Example FlowHandler</a></span></dt><dt><span class="sect2"><a href="#spring-mvc-flow-handler-adapter">10.4.2. Registering the FlowHandlerAdapter</a></span></dt><dt><span class="sect2"><a href="#spring-mvc-flow-handler-redirects">10.4.3. FlowHandler Redirects</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-mvc-config-spring-flow-controllers">10.5. Flow Controller</a></span></dt><dt><span class="sect1"><a href="#spring-mvc-config-spring-view-resolution">10.6. View Resolution</a></span></dt></dl></dd><dt><span class="chapter"><a href="#spring-js">11. Spring JavaScript Quick Reference</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-js-introduction">11.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-js-resource-servlet">11.2. Serving Javascript Resources</a></span></dt><dt><span class="sect1"><a href="#spring-js-includes">11.3. Including Spring Javascript in a Page</a></span></dt><dt><span class="sect1"><a href="#spring-js-decorations">11.4. Spring Javascript Decorations</a></span></dt><dt><span class="sect1"><a href="#spring-js-ajax">11.5. Handling Ajax Requests</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-js-ajax-mvc">11.5.1. Handling Ajax Requests with Spring MVC Controllers</a></span></dt><dt><span class="sect2"><a href="#spring-js-ajax-mvc-webflow">11.5.2. Handling Ajax Requests with Spring MVC + Spring Web Flow</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#spring-faces">12. JSF Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#spring-faces-introduction">12.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#spring-faces-integration">12.2. Spring-centric Integration Approach</a></span></dt><dt><span class="sect1"><a href="#spring-faces-config-web.xml">12.3. Configuring web.xml</a></span></dt><dt><span class="sect1"><a href="#spring-faces-webflow-config">12.4. Configuring Web Flow to render JSF views</a></span></dt><dt><span class="sect1"><a href="#spring-faces-config">12.5. Configuring faces-config.xml</a></span></dt><dt><span class="sect1"><a href="#spring-faces-managed-beans">12.6. Replacing the JSF Managed Bean Facility</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-flow-variables">12.6.1. Using Flow Variables</a></span></dt><dt><span class="sect2"><a href="#spring-faces-spring-beans">12.6.2. Using Scoped Spring Beans</a></span></dt><dt><span class="sect2"><a href="#faces-manipulating-model">12.6.3. Manipulating The Model</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-event-handling">12.7. Handling JSF Events With Spring Web Flow</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-in-page-events">12.7.1. Handling JSF In-page Action Events</a></span></dt><dt><span class="sect2"><a href="#spring-faces-action-events">12.7.2. Handling JSF Action Events</a></span></dt><dt><span class="sect2"><a href="#spring-faces-model-validation">12.7.3. Performing Model Validation</a></span></dt><dt><span class="sect2"><a href="#spring-faces-ajax-events">12.7.4. Handling Ajax Events</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-ui-controls">12.8. Enhancing The User Experience With Rich Web Forms</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-text-validation">12.8.1. Validating a Text Field</a></span></dt><dt><span class="sect2"><a href="#spring-faces-number-validation">12.8.2. Validating a Numeric Field</a></span></dt><dt><span class="sect2"><a href="#spring-faces-date-validation">12.8.3. Validating a Date Field</a></span></dt><dt><span class="sect2"><a href="#spring-faces-validate-all">12.8.4. Preventing an Invalid Form Submission</a></span></dt></dl></dd><dt><span class="sect1"><a href="#spring-faces-component-libraries">12.9. Third-Party Component Library Integration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#spring-faces-with-richfaces">12.9.1. Rich Faces Integration</a></span></dt><dt><span class="sect2"><a href="#spring-faces-with-trinidad">12.9.2. Apache MyFaces Trinidad Integration</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#portlet">13. Portlet Integration</a></span></dt><dd><dl><dt><span class="sect1"><a href="#portlet-introduction">13.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#portlet-config-core">13.2. Configuring web.xml and portlet.xml</a></span></dt><dt><span class="sect1"><a href="#portlet-config-spring">13.3. Configuring Spring</a></span></dt><dd><dl><dt><span class="sect2"><a href="#portlet-config-spring-handler">13.3.1. Flow Handlers</a></span></dt><dt><span class="sect2"><a href="#portlet-config-spring-mappings">13.3.2. Handler Mappings</a></span></dt><dt><span class="sect2"><a href="#portlet-config-spring-handler-adapter">13.3.3. Flow Handler Adapter</a></span></dt></dl></dd><dt><span class="sect1"><a href="#portlet-views">13.4. Portlet Views</a></span></dt><dt><span class="sect1"><a href="#portlet-modes">13.5. Portlet Modes and Window States</a></span></dt><dd><dl><dt><span class="sect2"><a href="#portlet-modes-state">13.5.1. Window State</a></span></dt><dt><span class="sect2"><a href="#portlet-modes-mode">13.5.2. Portlet Mode</a></span></dt></dl></dd><dt><span class="sect1"><a href="#portlet-issues">13.6. Issues in a Portlet Environment</a></span></dt><dd><dl><dt><span class="sect2"><a href="#portlet-issues-redirects">13.6.1. Redirects</a></span></dt><dt><span class="sect2"><a href="#portlet-issues-modes">13.6.2. Switching Portlet Modes</a></span></dt><dt><span class="sect2"><a href="#portlet-issues-jsf">13.6.3. Portlets and JSF</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#testing">14. Testing flows</a></span></dt><dd><dl><dt><span class="sect1"><a href="#testing-introduction">14.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#extending-abstractflowexecutiontest">14.2. Extending AbstractXmlFlowExecutionTests</a></span></dt><dt><span class="sect1"><a href="#override-getResource">14.3. Specifying the path to the flow to test</a></span></dt><dt><span class="sect1"><a href="#override-configureFlowBuilderContext">14.4. Registering flow dependencies</a></span></dt><dt><span class="sect1"><a href="#testing-flowstartup">14.5. Testing flow startup</a></span></dt><dt><span class="sect1"><a href="#testing-flowevents">14.6. Testing flow event handling</a></span></dt><dt><span class="sect1"><a href="#testing-mockingsubflows">14.7. Mocking a subflow</a></span></dt></dl></dd><dt><span class="chapter"><a href="#upgrade-guide">15. Upgrading from 1.0</a></span></dt><dd><dl><dt><span class="sect1"><a href="#upgrade-guide-introduction">15.1. Introduction</a></span></dt><dt><span class="sect1"><a href="#upgrade-guide-definition-language">15.2. Flow Definition Language</a></span></dt><dd><dl><dt><span class="sect2"><a href="#upgrade-guide-definition-language-tool">15.2.1. Flow Definition Updater Tool</a></span></dt><dd><dl><dt><span class="sect3"><a href="#upgrade-guide-definition-language-tool-warnings">15.2.1.1. Flow Definition Updater Tool Warnings</a></span></dt></dl></dd><dt><span class="sect2"><a href="#upgrade-guide-definition-language-el">15.2.2. EL Expressions</a></span></dt></dl></dd><dt><span class="sect1"><a href="#upgrade-guide-webflow-config">15.3. Web Flow Configuration</a></span></dt><dd><dl><dt><span class="sect2"><a href="#upgrade-guide-webflow-config-beans">15.3.1. Web Flow Bean Configuration</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-config-schema">15.3.2. Web Flow Schema Configuration</a></span></dt><dd><dl><dt><span class="sect3"><a href="#upgrade-guide-webflow-config-schema-executor">15.3.2.1. flow-executor</a></span></dt><dt><span class="sect3"><a href="#upgrade-guide-webflow-config-schema-listeners">15.3.2.2. flow-execution-listeners</a></span></dt><dt><span class="sect3"><a href="#upgrade-guide-webflow-config-schema-registry">15.3.2.3. flow-registry</a></span></dt></dl></dd><dt><span class="sect2"><a href="#upgrade-guide-java-controller">15.3.3. Flow Controller</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-java-url-handler">15.3.4. Flow Request URL Handler</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-config-view-resolver">15.3.5. View Resolution</a></span></dt></dl></dd><dt><span class="sect1"><a href="#upgrade-guide-webflow-concepts">15.4. New Web Flow Concepts</a></span></dt><dd><dl><dt><span class="sect2"><a href="#upgrade-guide-webflow-concepts-binding">15.4.1. Automatic Model Binding</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-concepts-el-v-ognl">15.4.2. OGNL vs EL</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-concepts-flash-scope">15.4.3. Flash Scope</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-concepts-jsf">15.4.4. Spring Faces</a></span></dt><dt><span class="sect2"><a href="#upgrade-guide-webflow-concepts-redirects">15.4.5. External Redirects</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#field-mappings">A. Flow Definition Language 1.0 to 2.0 Mappings</a></span></dt></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>
		Many web applications require the same sequence of steps to execute in different contexts.
		Often these sequences are merely components of a larger task the user is trying to accomplish.
		Such a reusable sequence is called a flow.
	</p><p>
		Consider a typical shopping cart application.
		User registration, login, and cart checkout are all examples of flows that can be invoked from several places in this type of application.
	</p><p>
		Spring Web Flow is the module of Spring for implementing flows.
		The Web Flow engine plugs into the Spring Web MVC platform and provides declarative flow definition language.
		This reference guide shows you how to use and extend Spring Web Flow.
	</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>1.&nbsp;Introduction</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manual-overview"></a>1.1.&nbsp;What this guide covers</h2></div></div></div><p>
			This guide covers all aspects of Spring Web Flow.
			It covers implementing flows in end-user applications and working with the feature set.
			It also covers extending the framework and the overall architectural model.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-requirements"></a>1.2.&nbsp;What Web Flow requires to run</h2></div></div></div><p>
			Java 1.4 or higher
		</p><p>
			Spring 2.5.4 or higher
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="support"></a>1.3.&nbsp;Where to get support</h2></div></div></div><p>
			Professional from-the-source support on Spring Web Flow is available from
			<a class="ulink" href="http://www.springsource.com" target="_top">SpringSource</a>, the company behind Spring, and
			<a class="ulink" href="http://www.ervacon.com" target="_top">Ervacon</a>, operated by Web Flow project co-founder Erwin Vervaet
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="development"></a>1.4.&nbsp;Where to follow development</h2></div></div></div><p>
			You can help make Web Flow best serve the needs of the Spring community by interacting with developers 
			at the <a class="ulink" href="http://forum.springframework.org" target="_top">Spring Community Forums</a>.
		</p><p>
			Report bugs and influence the Web Flow project roadmap using the <a class="ulink" href="http://jira.springframework.org" target="_top">Spring Issue Tracker</a>.
		</p><p>
			Subscribe to the <a class="ulink" href="http://www.springframework.org" target="_top">Spring Community Portal</a> for the latest Spring news and announcements.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jars"></a>1.5.&nbsp;How to obtain Web Flow artifacts from the SpringSource Bundle Repository</h2></div></div></div><p>
			Each jar in the Web Flow distribution is available in the <a class="ulink" href="http://www.springsource.com/repository/" target="_top">SpringSource Enterprise Bundle Repository</a>.
			These jars may be accessed using Maven or Ivy dependency managers.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jars-maven"></a>1.5.1.&nbsp;Accessing Web Flow with Maven</h3></div></div></div><p>
				To access jars using Maven, add the following repositories to your Maven pom:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">repository</span>&gt;
    &lt;<span class="hl-tag">id</span>&gt;com.springsource.repository.bundles.release&lt;<span class="hl-tag">/id</span>&gt;
    &lt;<span class="hl-tag">name</span>&gt;SpringSource Enterprise Bundle Repository - SpringSource Releases&lt;<span class="hl-tag">/name</span>&gt;
    &lt;<span class="hl-tag">url</span>&gt;http://repository.springsource.com/maven/bundles/release&lt;<span class="hl-tag">/url</span>&gt;
&lt;<span class="hl-tag">/repository</span>&gt;

&lt;<span class="hl-tag">repository</span>&gt;
    &lt;<span class="hl-tag">id</span>&gt;com.springsource.repository.bundles.external&lt;<span class="hl-tag">/id</span>&gt;
    &lt;<span class="hl-tag">name</span>&gt;SpringSource Enterprise Bundle Repository - External Releases&lt;<span class="hl-tag">/name</span>&gt;
    &lt;<span class="hl-tag">url</span>&gt;http://repository.springsource.com/maven/bundles/external&lt;<span class="hl-tag">/url</span>&gt;
&lt;<span class="hl-tag">/repository</span>&gt;
			</pre><p>
				Then declare the following dependencies:			
			</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.binding&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.js&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

			</pre><p>
				And if using JavaServerFaces:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.faces&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="jars-ivy"></a>1.5.2.&nbsp;Accessing Web Flow with Ivy</h3></div></div></div><p>
				To access jars using Ivy, add the following repositories to your Ivy config:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">url</span> <span class="hl-attribute">name</span>=<span class="hl-value">"com.springsource.repository.bundles.release"</span>&gt;
    &lt;<span class="hl-tag">ivy</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"http://repository.springsource.com/ivy/bundles/release/
                  [organisation]/[module]/[revision]/[artifact]-[revision].[ext]"</span> /&gt;
    &lt;<span class="hl-tag">artifact</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"http://repository.springsource.com/ivy/bundles/release/
                       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]"</span> /&gt;
&lt;<span class="hl-tag">/url</span>&gt;

&lt;<span class="hl-tag">url</span> <span class="hl-attribute">name</span>=<span class="hl-value">"com.springsource.repository.bundles.external"</span>&gt;
    &lt;<span class="hl-tag">ivy</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"http://repository.springsource.com/ivy/bundles/external/
                  [organisation]/[module]/[revision]/[artifact]-[revision].[ext]"</span> /&gt;
    &lt;<span class="hl-tag">artifact</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"http://repository.springsource.com/ivy/bundles/external/
                       [organisation]/[module]/[revision]/[artifact]-[revision].[ext]"</span> /&gt;
&lt;<span class="hl-tag">/url</span>&gt;
			</pre><p>
				Then declare the following dependencies:			
			</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span> <span class="hl-attribute">org</span>=<span class="hl-value">"org.springframework.webflow"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.binding"</span>
            <span class="hl-attribute">rev</span>=<span class="hl-value">"2.0.3.RELEASE"</span> <span class="hl-attribute">conf</span>=<span class="hl-value">"compile-&gt;runtime"</span> /&gt;
&lt;<span class="hl-tag">dependency</span> <span class="hl-attribute">org</span>=<span class="hl-value">"org.springframework.webflow"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.js"</span>
            <span class="hl-attribute">rev</span>=<span class="hl-value">"2.0.3.RELEASE"</span> <span class="hl-attribute">conf</span>=<span class="hl-value">"compile-&gt;runtime"</span> /&gt;
&lt;<span class="hl-tag">dependency</span> <span class="hl-attribute">org</span>=<span class="hl-value">"org.springframework.webflow"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.webflow"</span>
            <span class="hl-attribute">rev</span>=<span class="hl-value">"2.0.3.RELEASE"</span> <span class="hl-attribute">conf</span>=<span class="hl-value">"compile-&gt;runtime"</span> /&gt;

			</pre><p>
				And if using JavaServerFaces:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span> <span class="hl-attribute">org</span>=<span class="hl-value">"org.springframework.webflow"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"org.springframework.faces"</span>
            <span class="hl-attribute">rev</span>=<span class="hl-value">"2.0.3.RELEASE"</span> <span class="hl-attribute">conf</span>=<span class="hl-value">"compile-&gt;runtime"</span> /&gt;

			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jars-mvn-central"></a>1.6.&nbsp;How to obtain Web Flow artifacts from Maven Central</h2></div></div></div><p>
			Each jar in the Web Flow distribution is also available in the <a class="ulink" href="http://repo1.maven.org/maven2/" target="_top">Maven Central Repository</a>.
		</p><p>
			To access Web Flow jars from Maven Central, declare the following dependencies in your pom:			
		</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.binding&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.js&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt;

		</pre><p>
			And if using JavaServerFaces:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.faces&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.RELEASE&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e148"></a>1.7.&nbsp;How to Obtain Nightly Builds</h2></div></div></div><p>
			Nightly snapshots of the Web Flow trunk are available at the SpringSource Bundle Repository.
			To access snapshots, add the following repository to your pom:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">repository</span>&gt;
    &lt;<span class="hl-tag">id</span>&gt;com.springsource.repository.bundles.snapshot&lt;<span class="hl-tag">/id</span>&gt;
    &lt;<span class="hl-tag">name</span>&gt;SpringSource Enterprise Bundle Repository - Nightly Snapshots&lt;<span class="hl-tag">/name</span>&gt;
    &lt;<span class="hl-tag">url</span>&gt;http://repository.springsource.com/maven/bundles/snapshot&lt;<span class="hl-tag">/url</span>&gt;
&lt;<span class="hl-tag">/repository</span>&gt;
		</pre><p>
				Then declare the following dependencies:			
			</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.binding&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.CI-###&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.js&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.CI-###&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.CI-###&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

			</pre><p>
			And if using JavaServerFaces:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">dependency</span>&gt;
    &lt;<span class="hl-tag">groupId</span>&gt;org.springframework.webflow&lt;<span class="hl-tag">/groupId</span>&gt;
    &lt;<span class="hl-tag">artifactId</span>&gt;org.springframework.faces&lt;<span class="hl-tag">/artifactId</span>&gt;
    &lt;<span class="hl-tag">version</span>&gt;2.0.3.CI-###&lt;<span class="hl-tag">/version</span>&gt;
&lt;<span class="hl-tag">/dependency</span>&gt; 

		</pre><p>
				Where '###' above represents the build number like 2.0.3.CI-500.
				Get the latest build number by browsing the <a class="ulink" href="http://static.springframework.org/downloads/nightly/snapshot-download.php?project=SWF" target="_top">nightly build area</a>.
			</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="defining-flows"></a>2.&nbsp;Defining Flows</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="defining-flows-introduction"></a>2.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter begins the Users Section.
			It shows how to implement flows using the flow definition language.
			By the end of this chapter you should have a good understanding of language constructs, and be capable of authoring a flow definition.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-overview"></a>2.2.&nbsp;What is a flow?</h2></div></div></div><p>
			A flow encapsulates a reusable sequence of steps that can execute in different contexts.
			Below is a <a class="ulink" href="http://www.jjg.net/ia/visvocab/" target="_top">Garrett Information Architecture</a> diagram illustrating a reference to a flow that encapsulates the steps of a hotel booking process:
		</p><div class="mediaobject" align="center"><img src="images/hotels-site.png" align="middle"><div class="caption"><p>Site Map illustrating a reference to a flow</p></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-makeup"></a>2.3.&nbsp;What is the makeup of a typical flow?</h2></div></div></div><p>
			In Spring Web Flow, a flow consists of a series of steps called "states".
			Entering a state typically results in a view being displayed to the user.
			On that view, user events occur that are handled by the state.
			These events can trigger transitions to other states which result in view navigations.
		</p><p>
			The example below shows the structure of the book hotel flow referenced in the previous diagram:
		</p><div class="mediaobject" align="center"><img src="images/hotels-site-bookhotel-flow.png" align="middle"><div class="caption"><p>Flow diagram</p></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-authoring"></a>2.4.&nbsp;How are flows authored?</h2></div></div></div><p>
			Flows are authored by web application developers using a simple XML-based flow definition language.
			The next steps of this guide will walk you through the elements of this language.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="essential-flow-elements"></a>2.5.&nbsp;Essential language elements</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-element"></a>2.5.1.&nbsp;flow</h3></div></div></div><p>
				Every flow begins with the following root element:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

&lt;<span class="hl-tag">/flow</span>&gt;
			</pre><p>
				All states of the flow are defined within this element.
				The first state defined becomes the flow's starting point.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-state-element"></a>2.5.2.&nbsp;view-state</h3></div></div></div><p>
				Use the <code class="code">view-state</code> element to define a step of the flow that renders a view:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> /&gt;
			</pre><p>
				By convention, a view-state maps its id to a view template in the directory where the flow is located.
				For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code> 
				if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="transition-element"></a>2.5.3.&nbsp;transition</h3></div></div></div><p>
				Use the <code class="code">transition</code> element to handle events that occur within a state:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
			</pre><p>
				These transitions drive view navigations.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="end-state-element"></a>2.5.4.&nbsp;end-state</h3></div></div></div><p>
				Use the <code class="code">end-state</code> element to define a flow outcome:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
			</pre><p>
				When a flow transitions to a end-state it terminates and the outcome is returned.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-essential-language-elements"></a>2.5.5.&nbsp;Checkpoint: Essential language elements</h3></div></div></div><p>		
				With the three elements <code class="code">view-state</code>, <code class="code">transition</code>, and <code class="code">end-state</code>, you can quickly express your view navigation logic.
				Teams often do this before adding flow behaviors so they can focus on developing the user interface of the application with end users first.
				Below is a sample flow that implements its view navigation logic using these elements:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;

    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
		
&lt;<span class="hl-tag">/flow</span>&gt;	
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-actions"></a>2.6.&nbsp;Actions</h2></div></div></div><p>
			Most flows need to express more than just view navigation logic.
			Typically they also need to invoke business services of the application or other actions.
		</p><p>
			Within a flow, there are several points where you can execute actions.  These points are:
			</p><div class="itemizedlist"><ul type="disc"><li><p>On flow start</p></li><li><p>On state entry</p></li><li><p>On view render</p></li><li><p>On transition execution</p></li><li><p>On state exit</p></li><li><p>On flow end</p></li></ul></div><p>	
		</p><p>
			Actions are defined using a concise expression language.  Spring Web Flow uses the Unified EL by default.
			The next few sections will cover the essential language elements for defining actions.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="evaluate-element"></a>2.6.1.&nbsp;evaluate</h3></div></div></div><p>
				The action element you will use most often is the <code class="code">evaluate</code> element.
				Use the <code class="code">evaluate</code> element to evaluate an expression at a point within your flow.
				With this single tag you can invoke methods on Spring beans or any other flow variable.
				For example:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span> /&gt;		
			</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result"></a>2.6.1.1.&nbsp;Assigning an evaluate result</h4></div></div></div><p>
					If the expression returns a value, that value can be saved in the flow's data model called <code class="code">flowScope</code>:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span> /&gt;
				</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="evaluate-element-result-type"></a>2.6.1.2.&nbsp;Converting an evaluate result</h4></div></div></div><p>
					If the expression returns a value that may need to be converted, specify the desired type using the <code class="code">result-type</code> attribute:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotels"</span>
          <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span>/&gt;
				</pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-actions"></a>2.6.2.&nbsp;Checkpoint: flow actions</h3></div></div></div><p>		
				Now review the sample booking flow with actions added:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> /&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span> 
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;

    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
		
&lt;<span class="hl-tag">/flow</span>&gt;	
			</pre><p>
				This flow now creates a Booking object in flow scope when it starts.
				The id of the hotel to book is obtained from a flow input attribute.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inputoutput"></a>2.7.&nbsp;Input/Output Mapping</h2></div></div></div><p>
			Each flow has a well-defined input/output contract.
			Flows can be passed input attributes when they start, and can return output attributes when they end.
			In this respect, calling a flow is conceptually similar to calling a method with the following signature:
		</p><pre class="programlisting">
FlowOutcome flowId(Map&lt;String, Object&gt; inputAttributes);
		</pre><p>
			... where a <code class="code">FlowOutcome</code> has the following signature:
		</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FlowOutcome {
   <span class="hl-keyword">public</span> String getName();		        
   <span class="hl-keyword">public</span> Map&lt;String, Object&gt; getOutputAttributes();
}
		</pre><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="input-element"></a>2.7.1.&nbsp;input</h3></div></div></div><p>
				Use the <code class="code">input</code> element to declare a flow input attribute:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> /&gt;
			</pre><p>
				Input values are saved in flow scope under the name of the attribute.
				For example, the input above would be saved under the name <code class="code">hotelId</code>.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-type"></a>2.7.1.1.&nbsp;Declaring an input type</h4></div></div></div><p>
					Use the <code class="code">type</code> attribute to declare the input attribute's type:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> /&gt;
				</pre><p>
					If an input value does not match the declared type, a type conversion will be attempted.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-value"></a>2.7.1.2.&nbsp;Assigning an input value</h4></div></div></div><p>
					Use the <code class="code">value</code> attribute to specify an expression to assign the input value to:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.myParameterObject.hotelId"</span> /&gt;
				</pre><p>
					If the expression's value type can be determined, that metadata will be used for type coersion if no <code class="code">type</code> attribute is specified.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="input-element-required"></a>2.7.1.3.&nbsp;Marking an input as required</h4></div></div></div><p>
					Use the <code class="code">required</code> attribute to enforce the input is not null or empty:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"flowScope.hotelId"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
				</pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="output-element"></a>2.7.2.&nbsp;output</h3></div></div></div><p>
				Use the <code class="code">output</code> element to declare a flow output attribute.
				Output attributes are declared within end-states that represent specific flow outcomes.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span>&gt;
    &lt;<span class="hl-tag">output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> /&gt;  
&lt;<span class="hl-tag">/end-state</span>&gt;
			</pre><p>
				Output values are obtained from flow scope under the name of the attribute.
				For example, the output above would be assigned the value of the <code class="code">bookingId</code> variable.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="output-element-value"></a>2.7.2.1.&nbsp;Specifying the source of an output value</h4></div></div></div><p>
					Use the <code class="code">value</code> attribute to denote a specific output value expression:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"confirmationNumber"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.confirmationNumber"</span> /&gt;  
				</pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-input-output"></a>2.7.3.&nbsp;Checkpoint: input/output mapping</h3></div></div></div><p>		
				Now review the sample booking flow with input/output mapping:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;;

    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> /&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span> 
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
	
    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> &gt;
        &lt;<span class="hl-tag">output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span>/&gt;
    &lt;<span class="hl-tag">/end-state</span>&gt;

    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
		
&lt;<span class="hl-tag">/flow</span>&gt;	
			</pre><p>
				The flow now accepts a <code class="code">hotelId</code> input attribute and returns a <code class="code">bookingId</code> output attribute
				when a new booking is confirmed.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-variables"></a>2.8.&nbsp;Variables</h2></div></div></div><p>
			A flow may declare one or more instance variables.
			These variables are allocated when the flow starts.
			Any <code class="code">@Autowired</code> transient references the variable holds are also rewired when the flow resumes.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="var-element"></a>2.8.1.&nbsp;var</h3></div></div></div><p>
				Use the <code class="code">var</code> element to declare a flow variable:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span>/&gt;
			</pre><p>
				Make sure your variable's class implements <code class="code">java.io.Serializable</code>, as the instance state is saved between flow requests.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="calling-subflows"></a>2.9.&nbsp;Calling subflows</h2></div></div></div><p>
			A flow may call another flow as a subflow.  The flow will wait until the subflow returns, then respond to the subflow outcome.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="subflow-state-element"></a>2.9.1.&nbsp;subflow-state</h3></div></div></div><p>
				Use the <code class="code">subflow-state</code> element to call another flow as a subflow:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span> /&gt;  
    &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
&lt;<span class="hl-tag">/subfow-state</span>&gt;
			</pre><p>
				The above example calls the <code class="code">createGuest</code> flow, then waits for it to return.
				When the flow returns with a <code class="code">guestCreated</code> outcome, the new guest is added to the booking's guest list.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-input"></a>2.9.1.1.&nbsp;Passing a subflow input</h4></div></div></div><p>
					Use the <code class="code">input</code> element to pass input to the subflow:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span>&gt;
    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"booking"</span> /&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
&lt;<span class="hl-tag">/subfow-state</span>&gt;
				</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="subflow-state-element-output"></a>2.9.1.2.&nbsp;Mapping subflow output</h4></div></div></div><p>
					Simply refer to a subflow output attribute by its name within a outcome transition:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span> /&gt;  
&lt;<span class="hl-tag">/transition</span>&gt;
				</pre><p>
					In the above example, <code class="code">guest</code> is the name of an output attribute returned by the <code class="code">guestCreated</code> outcome.
				</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="checkpoint-subflow"></a>2.9.2.&nbsp;Checkpoint: calling subflows</h3></div></div></div><p>		
				Now review the sample booking flow calling a subflow:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> /&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span> 
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"addGuest"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"revise"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;

    &lt;<span class="hl-tag">subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
            &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.attributes.guest)"</span> /&gt;  
        &lt;<span class="hl-tag">/transition</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"creationCancelled"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">/subfow-state</span>&gt;
		
    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> &gt;
        &lt;<span class="hl-tag">output</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"booking.id"</span> /&gt;
    &lt;<span class="hl-tag">/end-state</span>&gt;

    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingCancelled"</span> /&gt;
		
&lt;<span class="hl-tag">/flow</span>&gt;		
			</pre><p>
				The flow now calls a <code class="code">createGuest</code> subflow to add a new guest to the guest list.
			</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="el"></a>3.&nbsp;Expression Language (EL)</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-introduction"></a>3.1.&nbsp;Introduction</h2></div></div></div><p>
			Web Flow uses EL to access its data model and invoke actions.
			This chapter will familiarize you with the EL syntax, and special EL variables you can reference from your flow definition.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-language-choices"></a>3.2.&nbsp;Supported EL implementations</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-unified-el"></a>3.2.1.&nbsp;Unified EL</h3></div></div></div><p>
				Web Flow attempts to use the <a class="ulink" href="http://en.wikipedia.org/wiki/Unified_Expression_Language" target="_top">Unified EL</a> by default. 
				<code class="code">jboss-el</code> is currently the default EL implementation.
				When found in your classpath along with the <code class="code">el-api</code>, it will be used automatically.
				You can find the JBoss EL jar in the <a class="ulink" href="http://www.springsource.com/repository/app/bundle/detail?name=com.springsource.org.jboss.el" target="_top">SpringSource Bundle Repository</a>.
				</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
					The <code class="code">el-api</code> dependency is typically <span class="emphasis"><em>provided</em></span> by your web container.  Tomcat 6 includes it, for example.
				</td></tr></table></div><p>
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-ognl"></a>3.2.2.&nbsp;OGNL</h3></div></div></div><p>
				<a class="ulink" href="http://www.ognl.org" target="_top">OGNL</a> is the other EL supported by Web Flow 2.
				OGNL is the EL most familiar to Web Flow version 1.0 users.
				To use ognl, simply include <code class="code">ognl</code> in your classpath instead of <code class="code">jboss-el</code>.
				Please refer to the <a class="ulink" href="http://www.ognl.org/2.6.9/Documentation/html/LanguageGuide/index.html" target="_top">OGNL language guide</a> for specifics on its EL syntax.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-portability"></a>3.3.&nbsp;EL portability</h2></div></div></div><p>
			In general, you will find the Unified EL and OGNL have a very similar syntax.
			For basic variable resolution, property access, and method invocation the syntax is identical.
			We recommend adhering to Unified EL syntax whenever possible, and only relying on proprietary EL features when needed.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-usage"></a>3.4.&nbsp;EL usage</h2></div></div></div><p>
			EL is used for many things within a flow, including:
		</p><div class="orderedlist"><ol type="1"><li><p>Accessing data provided by the client, such as flow input attributes and request parameters.</p></li><li><p>Accessing internal data structures such as <code class="code">flowScope.</code></p></li><li><p>Invoking methods on Spring beans.</p></li><li><p>Resolving constructs such as state transition criteria, subflow ids, and view names.</p></li></ol></div><p>
			Views rendered by flows typically access flow data structures using EL as well.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-types"></a>3.4.1.&nbsp;Expression types</h3></div></div></div><p>
				There are basically two types of expressions in Web Flow.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-eval"></a>3.4.1.1.&nbsp;Standard eval expressions</h4></div></div></div><p>
					The first, and most common, type of expression, is the standard <span class="emphasis"><em>eval expression</em></span>.
					Such expressions are dynamically evaluated by the EL and should not be enclosed in delimiters like <code class="code">${}</code> or <code class="code">#{}</code>.
					For example:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
				</pre><p>
					The expression above is a standard expression that invokes the <code class="code">nextPage</code> method on the <code class="code">searchCriteria</code> variable when evaluated.
					Attempting to enclose this expression in special eval delimiters like <code class="code">${}</code> or <code class="code">#{}</code> will result in an <code class="code">IllegalArgumentException</code>.
					</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
						We view use of special eval delimiters as redundant in this context, as the only acceptable value for the <code class="code">expression</code> attribute is a single eval expression string.
					</td></tr></table></div><p>
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="el-types-template"></a>3.4.1.2.&nbsp;Template expressions</h4></div></div></div><p>
					The second type of expression is a "template" expression.
					Such expressions allow a mixing of literal text with one or more eval blocks.
					Each eval block is explictly delimited with the <code class="code">${}</code> delimiters.
					For example:
				</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"error"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"error-${externalContext.locale}.xhtml"</span> /&gt;
				</pre><p>
					The expression above is a template expression.
					The result of evaluation will be a string that concatenates the literal text <code class="code">error-</code> with the result of evaluating <code class="code">externalContext.locale</code>.
					As you can see, explicit delimiters are necessary here to demarcate eval blocks within the template.
				</p></div><p>
				See the Web Flow XML schema for a complete listing of the XML attributes that accept standard expressions and template expressions.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-variables"></a>3.5.&nbsp;Special EL variables</h2></div></div></div><p>
			There are several implicit variables you may reference from within a flow.
			These variables are discussed in this section.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowScope"></a>3.5.1.&nbsp;flowScope</h3></div></div></div><p>
				Use <code class="code">flowScope</code> to assign a flow variable.
				Flow scope gets allocated when a flow starts and destroyed when the flow ends.  With the default 
                implementation, any objects stored in flow scope need to be Serializable.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.hotel"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-viewScope"></a>3.5.2.&nbsp;viewScope</h3></div></div></div><p>
				Use <code class="code">viewScope</code> to assign a view variable.
				View scope gets allocated when a <code class="code">view-state</code> enters and destroyed when the state exits.
				View scope is <span class="emphasis"><em>only</em></span> referenceable from within a <code class="code">view-state</code>.  With the 
                default implementation, any objects stored in view scope need to be Serializable.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">on-render</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span>
              <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
&lt;<span class="hl-tag">/on-render</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestScope"></a>3.5.3.&nbsp;requestScope</h3></div></div></div><p>
				Use <code class="code">requestScope</code> to assign a request variable.
				Request scope gets allocated when a flow is called and destroyed when the flow returns.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flashScope"></a>3.5.4.&nbsp;flashScope</h3></div></div></div><p>
				Use <code class="code">flashScope</code> to assign a flash variable.
				Flash scope gets allocated when a flow starts, cleared after every view render, and destroyed when the 
                flow ends.  With the default implementation, any objects stored in flash scope need to be Serializable.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.statusMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"'Booking confirmed'"</span> /&gt;				
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-conversationScope"></a>3.5.5.&nbsp;conversationScope</h3></div></div></div><p>
				Use <code class="code">conversationScope</code> to assign a conversation variable.
				Conversation scope gets allocated when a top-level flow starts and destroyed when the top-level flow ends.
				Conversation scope is shared by a top-level flow and all of its subflows.  With the default 
                implementation, conversation scoped objects are stored in the HTTP session and should generally be 
                Serializable to account for typical session replication.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.findHotel(hotelId)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"conversationScope.hotel"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestParameters"></a>3.5.6.&nbsp;requestParameters</h3></div></div></div><p>
				Use <code class="code">requestParameters</code> to access a client request parameter:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentEvent"></a>3.5.7.&nbsp;currentEvent</h3></div></div></div><p>
				Use <code class="code">currentEvent</code> to access attributes of the current <code class="code">Event</code>:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guests.add(currentEvent.guest)"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-currentUser"></a>3.5.8.&nbsp;currentUser</h3></div></div></div><p>
				Use <code class="code">currentUser</code> to access the authenticated <code class="code">Principal</code>:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span> 
          <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-messageContext"></a>3.5.9.&nbsp;messageContext</h3></div></div></div><p>
				Use <code class="code">messageContext</code> to access a context for retrieving and creating flow execution messages, including error and success messages.
				See the <code class="code">MessageContext</code> Javadocs for more information.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingValidator.validate(booking, messageContext)"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-resourceBundle"></a>3.5.10.&nbsp;resourceBundle</h3></div></div></div><p>
				Use <code class="code">resourceBundle</code> to access a message resource.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flashScope.successMessage"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"resourceBundle.successMessage"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-requestContext"></a>3.5.11.&nbsp;flowRequestContext</h3></div></div></div><p>
				Use <code class="code">flowRequestContext</code> to access the <code class="code">RequestContext</code> API, which is a representation of the current flow request.
				See the API Javadocs for more information.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionContext"></a>3.5.12.&nbsp;flowExecutionContext</h3></div></div></div><p>
				Use <code class="code">flowExecutionContext</code> to access the <code class="code">FlowExecutionContext</code> API, which is a representation of the current flow state.
				See the API Javadocs for more information.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-flowExecutionUrl"></a>3.5.13.&nbsp;flowExecutionUrl</h3></div></div></div><p>
				Use <code class="code">flowExecutionUrl</code> to access the context-relative URI for the current flow execution view-state.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="el-variable-externalContext"></a>3.5.14.&nbsp;externalContext</h3></div></div></div><p>
				Use <code class="code">externalContext</code> to access the client environment, including user session attributes.
				See the <code class="code">ExternalContext</code> API JavaDocs for more information.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchService.suggestHotels(externalContext.sessionMap.userProfile)"</span> 
          <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> /&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="el-scope-searching"></a>3.6.&nbsp;Scope searching algorithm</h2></div></div></div><p>
			When assigning a variable in one of the flow scopes, referencing that scope is required.
			For example:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"requestScope.hotelId"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"requestParameters.id"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"long"</span> /&gt;
		</pre><p>
			When simply accessing a variable in one of the scopes, referencing the scope is optional.
			For example:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"entityManager.persist(booking)"</span> /&gt;
		</pre><p>
			If no scope is specified, like in the use of <code class="code">booking</code> above, a scope searching algorithm will be employed.
			The algorithm will look in request, flash, view, flow, and conversation scope for the variable.
			If no such variable is found, an <code class="code">EvaluationException</code> will be thrown.
		</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="views"></a>4.&nbsp;Rendering views</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="views-introduction"></a>4.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows you how to use the <code class="code">view-state</code> element to render views within a flow.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-convention"></a>4.2.&nbsp;Defining view states</h2></div></div></div><p>
			Use the <code class="code">view-state</code> element to define a step of the flow that renders a view and waits for a user event to resume:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
		</pre><p>
			By convention, a view-state maps its id to a view template in the directory where the flow is located.
			For example, the state above might render <code class="filename">/WEB-INF/hotels/booking/enterBookingDetails.xhtml</code>
			if the flow itself was located in the <code class="filename">/WEB-INF/hotels/booking</code> directory.
		</p><p>
			Below is a sample directory structure showing views and other resources like message bundles co-located with their flow definition:
		</p><div class="mediaobject" align="center"><img src="images/flow-view-packaging.png" align="middle"><div class="caption"><p>Flow Packaging</p></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-explicit"></a>4.3.&nbsp;Specifying view identifiers</h2></div></div></div><p>
			Use the <code class="code">view</code> attribute to explictly specify the id of the view to render.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-flowrelative"></a>4.3.1.&nbsp;Flow relative view ids</h3></div></div></div><p>
				The view id may be a relative path to view resource in the flow's working directory:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails.xhtml"</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-absolute"></a>4.3.2.&nbsp;Absolute view ids</h3></div></div></div><p>
				The view id may be a absolute path to a view resource in the webapp root directory:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"/WEB-INF/hotels/booking/bookingDetails.xhtml"</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-explicit-logical"></a>4.3.3.&nbsp;Logical view ids</h3></div></div></div><p>
				With some view frameworks, such as Spring MVC's view framework, the view id may also be a logical identifier resolved by the framework:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"bookingDetails"</span>&gt;
			</pre><p>
				See the Spring MVC integration section for more information on how to integrate with the MVC <code class="code">ViewResolver</code> infrastructure.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-scope"></a>4.4.&nbsp;View scope</h2></div></div></div><p>
			A view-state allocates a new <code class="code">viewScope</code> when it enters.
			This scope may be referenced within the view-state to assign variables that should live for the duration of the state.
			This scope is useful for manipulating objects over a series of requests from the same view, often Ajax requests.
			A view-state destroys its viewScope when it exits.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-var"></a>4.4.1.&nbsp;Allocating view variables</h3></div></div></div><p>
				Use the <code class="code">var</code> tag to declare a view variable.
				Like a flow variable, any <code class="code">@Autowired</code> references are automatically restored when the view state resumes.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.SearchCriteria"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-actions"></a>4.4.2.&nbsp;Assigning a viewScope variable</h3></div></div></div><p>
				Use the <code class="code">on-render</code> tag to assign a variable from an action result before the view renders:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">on-render</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> /&gt;
&lt;<span class="hl-tag">/on-render</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-scope-ajax"></a>4.4.3.&nbsp;Manipulating objects in view scope</h3></div></div></div><p>
				Objects in view scope are often manipulated over a series of requests from the same view.
				The following example pages through a search results list. 
				The list is updated in view scope before each render.
				Asynchronous event handlers modify the current data page, then request re-rendering of the search results fragment.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchResults"</span>&gt;
    &lt;<span class="hl-tag">on-render</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> /&gt;
    &lt;<span class="hl-tag">/on-render</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
        &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span> /&gt;            
    &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"previous"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.previousPage()"</span> /&gt;
        &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span> /&gt;          
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-on-render"></a>4.5.&nbsp;Executing render actions</h2></div></div></div><p>
			Use the <code class="code">on-render</code> element to execute one or more actions before view rendering.
			Render actions are executed on the initial render as well as any subsequent refreshes, including any partial re-renderings of the view.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">on-render</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> /&gt;
&lt;<span class="hl-tag">/on-render</span>&gt;
	    </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-model"></a>4.6.&nbsp;Binding to a model</h2></div></div></div><p>
			Use the <code class="code">model</code> attribute to declare a model object the view binds to.
			This attribute is typically used in conjunction with views that render data controls, such as forms.
			It enables form data binding and validation behaviors to be driven from metadata on your model object.
		</p><p>
			The following example declares an <code class="code">enterBookingDetails</code> state manipulates the <code class="code">booking</code> model:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
	    </pre><p>		
			The model may an object in any accessible scope, such as <code class="code">flowScope</code> or <code class="code">viewScope</code>.
			Specifying a <code class="code">model</code> triggers the following behavior when a view event occurs:
		</p><div class="orderedlist"><ol type="1"><li><p>View-to-model binding.  On view postback, user input values are bound to model object properties for you.</p></li><li><p>Model validation.  After binding, if the model object requires validation that validation logic will be invoked.</p></li></ol></div><p>
			For a flow event to be generated that can drive a view state transition, model binding must complete successfully.
			If model binding fails, the view is re-rendered to allow the user to revise their edits.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-bind"></a>4.7.&nbsp;Suppressing binding</h2></div></div></div><p>
			Use the <code class="code">bind</code> attribute to suppress model binding and validation for particular view events.
			The following example suppresses binding when the <code class="code">cancel</code> event occurs:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-binder"></a>4.8.&nbsp;Specifying bindings explicitly</h2></div></div></div><p>
			Use the <code class="code">binder</code> element to configure the exact set of model bindings usable by the view.
			This is particularly useful in a Spring MVC environment for restricting the set of "allowed fields" per view.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
    &lt;<span class="hl-tag">binder</span>&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span> /&gt;
    &lt;<span class="hl-tag">/binder</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;

		</pre><p>
			If the binder element is not specified, all public properties of the model are eligible for binding by the view.
			With the binder element specified, only the explicitly configured bindings are allowed.
		</p><p>
			Each binding may also apply a converter to format the model property value for display in a custom manner.
			If no converter is specified, the default converter for the model property's type will be used.		
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
    &lt;<span class="hl-tag">binder</span>&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> /&gt;    
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span> /&gt;
    &lt;<span class="hl-tag">/binder</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span> /&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;

		</pre><p>
			In the example above, the <code class="code">shortDate</code> converter is bound to the 
			<code class="code">checkinDate</code> and <code class="code">checkoutDate</code> properties.
			Custom converters may be registered with the application's ConversionService.
		</p><p>
			Each binding may also apply a required check that will generate a validation error
			if the user provided value is null on form postback:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
    &lt;<span class="hl-tag">binder</span>&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"checkoutDate"</span> <span class="hl-attribute">converter</span>=<span class="hl-value">"shortDate"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCard"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardName"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryMonth"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
        &lt;<span class="hl-tag">binding</span> <span class="hl-attribute">property</span>=<span class="hl-value">"creditCardExpiryYear"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> /&gt;
    &lt;<span class="hl-tag">/binder</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">bind</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
		</pre><p>
			In the example above, all of the bindings are required.
			If one or more blank input values are bound, validation errors will be generated and the view will re-render with those errors.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validate"></a>4.9.&nbsp;Validating a model</h2></div></div></div><p>
			Model validation is driven by constraints specified against the model object.
			These constraints may be specified declaratively, or enforced using a programmatic validation routine or external <code class="code">Validator</code>.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-programmatic"></a>4.9.1.&nbsp;Programmatic validation</h3></div></div></div><p>
				There are two ways to perform model validation programatically.
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation=programmatic-validate-method"></a>4.9.1.1.&nbsp;Implementing a model validate method</h4></div></div></div><p>
					The first way is to define a validate method on the model object class.
					To do this, create a public method with the name <code class="code">validate${state}</code>, where <code class="code">state</code> is the id of your view-state.
					The method must declare a <code class="code">MessageContext</code> parameter for recording validation error messages.
					For example:
				</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(MessageContext context) {
    Calendar calendar = Calendar.getInstance();
    <span class="hl-keyword">if</span> (checkinDate.before(today())) {
        context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).defaultText(
            <span class="hl-string">"Check in date must be a future date"</span>).build());
    } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!checkinDate.before(checkoutDate)) {
        context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).defaultText(
            <span class="hl-string">"Check out date must be later than check in date"</span>).build());
    }
}
				</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="view-validation=programmatic-validator"></a>4.9.1.2.&nbsp;Implementing a Validator</h4></div></div></div><p>
					The second way is to define a separate object, called a <span class="emphasis"><em>Validator</em></span>, which validates your model object.
					To do this, create a class that defines a public method with the name <code class="code">validate${state}</code>, where <code class="code">state</code> is the id of your view-state.
					The method must declare a parameter to accept your model object, and a <code class="code">MessageContext</code> parameter for recording validation error messages.
					For example:
				</p><pre class="programlisting">
@Component
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingValidator {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateEnterBookingDetails(Booking booking, MessageContext context) {
        <span class="hl-keyword">if</span> (booking.getCheckinDate().before(today())) {
            context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkinDate"</span>).defaultText(
                <span class="hl-string">"Check in date must be a future date"</span>).build());
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (!booking.getCheckinDate().before(checkoutDate)) {
            context.addMessage(<span class="hl-keyword">new</span> MessageBuilder().error().source(<span class="hl-string">"checkoutDate"</span>).defaultText(
                <span class="hl-string">"Check out date must be later than check in date"</span>).build());
        }
    }
}
				</pre><p>
					A Validator can also accept a Spring MVC <code class="code">Errors</code> object, which is required for invoking existing Spring Validators.
				</p><p>
					Validators must be registered as Spring beans employing the naming convention <code class="code">${model}Validator</code> to be detected and invoked automatically.
					In the example above, Spring 2.5 classpath-scanning would detect the <code class="code">@Component</code> and automatically register it as a bean with the name <code class="code">bookingValidator</code>.
					Then, anytime the <code class="code">booking</code> model needs to be validated, this <code class="code">bookingValidator</code> instance would be invoked for you.
				</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="view-validation-declarative"></a>4.9.2.&nbsp;Declarative validation</h3></div></div></div><p>
				Spring Web Flow does not yet ship integration with a declarative validation framework such as Hibernate Validator.
				It is expected that integration will be provided in a future Web Flow release.
				This integration will allow declarative validation constraints to be defined against model properties.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-validation-suppression"></a>4.10.&nbsp;Suppressing validation</h2></div></div></div><p>
			Use the <code class="code">validate</code> attribute to suppress model validation for particular view events:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"chooseAmenities"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"booking"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"back"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"enterBookingDetails"</span> <span class="hl-attribute">validate</span>=<span class="hl-value">"false"</span> /&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
		</pre><p>
			In this example, data binding will still occur on <code class="code">back</code> but validation will be suppressed.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="transition-actions"></a>4.11.&nbsp;Transition actions</h2></div></div></div><p>
			A view-state transition can execute one or more actions before executing.
			These actions may return an error result to prevent the transition itself from executing.
			If an error result occurs, the view will re-render and should typically display an appropriate error message to the user.
		</p><p>
			If the transition action invokes a plain Java method, the invoked method may return false to prevent the transition from executing.
			This technique can be used to handle exceptions thrown by service-layer methods.
			The example below invokes an action that calls a service and handles an exceptional situation:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingAction.makeBooking(booking, messageContext)"</span> /&gt;
&lt;<span class="hl-tag">/transition</span>&gt;
		</pre><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingAction {
   <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> makeBooking(Booking booking, MessageContext context) {
       <span class="hl-keyword">try</span> {
           bookingService.make(booking);
           <span class="hl-keyword">return</span> true;
       } <span class="hl-keyword">catch</span> (RoomNotAvailableException e) {
           context.addMessage(builder.error().
               .defaultText(<span class="hl-string">"No room is available at this hotel"</span>).build());
           <span class="hl-keyword">return</span> false;
       }
   }
}
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="simple-event-handlers"></a>4.12.&nbsp;Handling events</h2></div></div></div><p>
			From a view-state, transitions without targets can also be defined.  Such transitions are called "event handlers":
		</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"event"</span>&gt;
    &lt;<span class="hl-comment">!-- Handle event --</span>&gt;
&lt;<span class="hl-tag">/transition</span>&gt;
		</pre><p>
			These event handlers do not change the state of the flow.
			They simply execute their actions and re-render the current view or one or more fragments of the current view.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-render"></a>4.12.1.&nbsp;Rendering partials</h3></div></div></div><p>
				Use the <code class="code">render</code> element to request partial re-rendering of a view after handling an event:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
    &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"searchResultsFragment"</span> /&gt;            
&lt;<span class="hl-tag">/transition</span>&gt;
			</pre><p>
				The fragments attribute should reference the ID(s) of the view element(s) you wish to re-render.
				Specify multiple elements to re-render by separating them with a comma delimiter.
			</p><p>
				Such partial rendering is often used with events signaled by Ajax to update a specific zone of the view.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="event-handlers-global"></a>4.12.2.&nbsp;Handling global events</h3></div></div></div><p>
				Use the flow's <code class="code">global-transitions</code> element to create event handlers that apply across all views.
				Global-transitions are often used to handle global menu links that are part of the layout.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">global-transitions</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"login"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"login"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"logout"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"logout"</span>&gt;
&lt;<span class="hl-tag">/global-transitions</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-messages"></a>4.13.&nbsp;Working with messages</h2></div></div></div><p>
			Spring Web Flow's <code class="code">MessageContext</code> is an API for recording messages during the course of flow executions.
			Plain text messages can be added to the context, as well as internationalized messages resolved by a Spring <code class="code">MessageSource</code>.
			Messages are renderable by views and automatically survive flow execution redirects.
			Three distinct message severities are provided: <code class="code">info</code>, <code class="code">warning</code>, and <code class="code">error</code>.
			In addition, a convenient <code class="code">MessageBuilder</code> exists for fluently constructing messages.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message"></a>4.13.1.&nbsp;Adding plain text messages</h3></div></div></div><pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>)
    .defaultText(<span class="hl-string">"Check in date must be a future date"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>)
    .defaultText(<span class="hl-string">"Smoking is bad for your health"</span>).build());
context.addMessage(builder.info()
    .defaultText(<span class="hl-string">"We have processed your reservation - thank you and enjoy your stay"</span>).build());
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="plain-text-message-intl"></a>4.13.2.&nbsp;Adding internationalized messages</h3></div></div></div><pre class="programlisting">
MessageContext context = ...
MessageBuilder builder = <span class="hl-keyword">new</span> MessageBuilder();
context.addMessage(builder.error().source(<span class="hl-string">"checkinDate"</span>).code(<span class="hl-string">"checkinDate.notFuture"</span>).build());
context.addMessage(builder.warn().source(<span class="hl-string">"smoking"</span>).code(<span class="hl-string">"notHealthy"</span>)
    .resolvableArg(<span class="hl-string">"smoking"</span>).build());			
context.addMessage(builder.info().code(<span class="hl-string">"reservationConfirmation"</span>).build());
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-bundles"></a>4.13.3.&nbsp;Using message bundles</h3></div></div></div><p>
				Internationalized messages are defined in message bundles accessed by a Spring <code class="code">MessageSource</code>.
				To create a flow-specific message bundle, simply define <code class="code">messages.properties</code> file(s) in your flow's directory.
				Create a default <code class="code">messages.properties</code> file and a .properties file for each additional <code class="code">Locale</code> you need to support.
			</p><pre class="programlisting">
#messages.properties
checkinDate=Check in date must be a future date
notHealthy={0} is bad for your health
reservationConfirmation=We have processed your reservation - thank you and enjoy your stay
			</pre><p>
				From within a view or a flow, you may also access message resources using the <code class="code">resourceBundle</code> EL variable:
			</p><pre class="programlisting">
&lt;h:outputText value="#{resourceBundle.reservationConfirmation}" /&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-popup"></a>4.14.&nbsp;Displaying popups</h2></div></div></div><p>
			Use the <code class="code">popup</code> attribute to render a view in a modal popup dialog:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span>&gt;
		</pre><p>
			When using Web Flow with the Spring Javascript, no client side code is necessary for the popup to display.
			Web Flow will send a response to the client requesting a redirect to the view from a popup, and the client will honor the request.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="view-backtracking"></a>4.15.&nbsp;View backtracking</h2></div></div></div><p>
			By default, when you exit a view state and transition to a new view state, you can go back to the previous state using the browser back button.
			These view state history policies are configurable on a per-transition basis by using the <code class="code">history</code> attribute.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-discard"></a>4.15.1.&nbsp;Discarding history</h3></div></div></div><p>
				Set the history attribute to <code class="code">discard</code> to prevent backtracking to a view:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingCancelled"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"discard"</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-invalidate"></a>4.15.2.&nbsp;Invalidating history</h3></div></div></div><p>
				Set the history attribute to <code class="code">invalidate</code> to prevent backtracking to a view as well all previously displayed views:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"confirm"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"bookingConfirmed"</span> <span class="hl-attribute">history</span>=<span class="hl-value">"invalidate"</span>&gt;
			</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="actions"></a>5.&nbsp;Executing actions</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-introduction"></a>5.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows you how to use the <code class="code">action-state</code> element to control the execution of an action at a point within a flow.
			It will also show how to use the <code class="code">decision-state</code> element to make a flow routing decision.
			Finally, several examples of invoking actions from the various points possible within a flow will be discussed.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-state"></a>5.2.&nbsp;Defining action states</h2></div></div></div><p>
			Use the <code class="code">action-state</code> element when you wish to invoke an action, then transition to another state based on the action's outcome:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span>/&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span> /&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span> /&gt;
&lt;<span class="hl-tag">/action-state</span>&gt;

        </pre><p>
			The full example below illustrates a interview flow that uses the action-state above to determine if more answers are needed to complete the interview:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interviewFactory.createInterview()"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.interview"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"answerQuestions"</span> <span class="hl-attribute">model</span>=<span class="hl-value">"questionSet"</span>&gt;
    	&lt;<span class="hl-tag">on-entry</span>&gt;
            &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.getNextQuestionSet()"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.questionSet"</span> /&gt;
    	&lt;<span class="hl-tag">/on-entry</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"submitAnswers"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"moreAnswersNeeded"</span>&gt;
            &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.recordAnswers(questionSet)"</span> /&gt;
        &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;
    
    &lt;<span class="hl-tag">action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span>/&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span> /&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span> /&gt;
    &lt;<span class="hl-tag">/action-state</span>&gt;

    &lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"finish"</span> /&gt;
    
&lt;<span class="hl-tag">/flow</span>&gt;
			</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="decision-state"></a>5.3.&nbsp;Defining decision states</h2></div></div></div><p>
			Use the <code class="code">decision-state</code> element as an alternative to the action-state to make a routing decision using a convenient if/else syntax.
			The example below shows the <code class="code">moreAnswersNeeded</code> state above now implemented as a decision state instead of an action-state:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">decision-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span>&gt;
    &lt;<span class="hl-tag">if</span> <span class="hl-attribute">test</span>=<span class="hl-value">"interview.moreAnswersNeeded"</span> <span class="hl-attribute">then</span>=<span class="hl-value">"answerQuestions"</span> <span class="hl-attribute">else</span>=<span class="hl-value">"finish"</span>/&gt;
&lt;<span class="hl-tag">/decision-state</span>&gt;

			</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-outcome-events"></a>5.4.&nbsp;Action outcome event mappings</h2></div></div></div><p>
			Actions often invoke methods on plain Java objects.
			When called from action-states and decision-states, these method return values can be used to drive state transitions.
			Since transitions are triggered by events, a method return value must first be mapped to an Event object.
			The following table describes how common return value types are mapped to Event objects:
		</p><div class="table"><a name="event-mapping-table"></a><p class="title"><b>Table&nbsp;5.1.&nbsp;Action method return value to event id mappings</b></p><div class="table-contents"><table summary="Action method return value to event id mappings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">Method return type</th><th style="border-bottom: 0.5pt solid ; ">Mapped Event identifier expression</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.Boolean</td><td style="border-bottom: 0.5pt solid ; ">yes (for true), no (for false)</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.Enum</td><td style="border-bottom: 0.5pt solid ; ">the Enum name</td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">java.lang.String</td><td style="border-bottom: 0.5pt solid ; ">the String value</td></tr><tr><td style="border-right: 0.5pt solid ; ">any other type</td><td style="">success</td></tr></tbody></table></div></div><br class="table-break"><p>
			This is illustrated in the example action state below, which invokes a method that returns a boolean value:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">action-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"moreAnswersNeeded"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"interview.moreAnswersNeeded()"</span>/&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"yes"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"answerQuestions"</span> /&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"no"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span> /&gt;
&lt;<span class="hl-tag">/action-state</span>&gt;

        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="action-examples"></a>5.5.&nbsp;Action execution examples</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-start"></a>5.5.1.&nbsp;on-start</h3></div></div></div><p>
				The following example shows an action that creates a new Booking object by invoking a method on a service:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelId"</span> /&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.createBooking(hotelId, currentUser.name)"</span> 
                  <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.booking"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

&lt;<span class="hl-tag">/flow</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-state-entry"></a>5.5.2.&nbsp;on-entry</h3></div></div></div><p>
				The following example shows a state entry action that sets the special <code class="code">fragments</code> variable that causes the view-state to render a partial fragment of its view:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">on-entry</span>&gt;
        &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotelSearchForm"</span> /&gt;
    &lt;<span class="hl-tag">/on-entry</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-state-exit"></a>5.5.3.&nbsp;on-exit</h3></div></div></div><p>
				The following example shows a state exit action that releases a lock on a record being edited:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"editOrder"</span>&gt;
    &lt;<span class="hl-tag">on-entry</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.selectForUpdate(orderId, currentUser)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.order"</span> /&gt;
    &lt;<span class="hl-tag">/on-entry</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"save"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.update(order, currentUser)"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">on-exit</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.releaseLock(order, currentUser)"</span> /&gt;
    &lt;<span class="hl-tag">/on-exit</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="on-end"></a>5.5.4.&nbsp;on-end</h3></div></div></div><p>
				The following example shows the equivalent object locking behavior using flow start and end actions:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">input</span> <span class="hl-attribute">name</span>=<span class="hl-value">"orderId"</span> /&gt;

    &lt;<span class="hl-tag">on-start</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.selectForUpdate(orderId, currentUser)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"flowScope.order"</span> /&gt;
    &lt;<span class="hl-tag">/on-start</span>&gt;

    &lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"editOrder"</span>&gt;
        &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"save"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"finish"</span>&gt;
            &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.update(order, currentUser)"</span> /&gt;
        &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">/view-state</span>&gt;

    &lt;<span class="hl-tag">on-end</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"orderService.releaseLock(order, currentUser)"</span> /&gt;
    &lt;<span class="hl-tag">/on-end</span>&gt;
    
&lt;<span class="hl-tag">/flow</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-render"></a>5.5.5.&nbsp;on-render</h3></div></div></div><p>
				The following example shows a render action that loads a list of hotels to display before the view is rendered:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span>&gt;
    &lt;<span class="hl-tag">on-render</span>&gt;
	    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
    &lt;<span class="hl-tag">/on-render</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"select"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotel"</span>&gt;
        &lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowScope.hotel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"hotels.selectedRow"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="action-on-transition"></a>5.5.6.&nbsp;on-transition</h3></div></div></div><p>
				The following example shows a transition action adds a subflow outcome event attribute to a collection:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">subflow-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"addGuest"</span> <span class="hl-attribute">subflow</span>=<span class="hl-value">"createGuest"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"guestCreated"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.guestList.add(currentEvent.attributes.newGuest)"</span> /&gt;  
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/subfow-state</span>&gt;
			</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="flow-managed-persistence"></a>6.&nbsp;Flow Managed Persistence</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-managed-persistence-introduction"></a>6.1.&nbsp;Introduction</h2></div></div></div><p>
			Most applications access data in some way.
			Many modify data shared by multiple users and therefore require transactional data access properties.
			This chapter shows you how to use flows to manage data access in a web application.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-managed-data-access-patterns"></a>6.2.&nbsp;Data access patterns</h2></div></div></div><p>
			There are essentially three flow-managed data access patterns:
		</p><div class="orderedlist"><ol type="1"><li><p>The FlowScoped PersistenceContext</p></li><li><p>The ConversationScoped PersistenceContext</p></li><li><p>The ViewState PersistenceContext</p></li></ol></div><p>
			Apart from these three patterns, there is the pattern of fully encapsulating PersistenceContext management within the service layer of your application.
			In that case, the web layer does not get involved with persistence, instead it works entirely with detached objects that are passed to and returned by your service layer.
			This chapter will focus on the flow-managed persistence patterns, exploring how and when to use them.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flowScopedPersistenceContext"></a>6.3.&nbsp;FlowScoped PersistenceContext</h2></div></div></div><p>
			This pattern creates a <code class="code">PersistenceContext</code> in <code class="code">flowScope</code> on flow startup,
			uses that context for data access during the course of flow execution, and commits changes made to persistent entities at the end.
			This pattern provides isolation of intermediate edits by only committing changes to the database at the end of flow execution.
			This pattern is often used in conjunction with an optimistic locking strategy to protect the integrity of data modified in parallel by multiple users.
			To support saving and restarting the progress of a flow over an extended period of time, a durable store for conversational state must be used.
			If a save and restart capability is not required, standard HTTP session-based storage of conversational state is sufficient.
			In that case, session expiration or termination before commit could potentially result in changes being lost.
		</p><p>
			To use the FlowScoped PersistenceContext pattern, first mark your flow as a <code class="code">persistence-context</code>:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow"</span>
      <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow
                          http://www.springframework.org/schema/webflow/spring-webflow-2.0.xsd"</span>&gt;

    &lt;<span class="hl-tag">persistence-context</span>&gt;
    
&lt;<span class="hl-tag">/flow</span>&gt;
</pre><p>
			Then configure the correct <code class="code">FlowExecutionListener</code> to apply this pattern to your flow.
			If using Hibernate, register the <code class="code">HibernateFlowExecutionListener</code>.  If using JPA, register the <code class="code">JpaFlowExecutionListener</code>.		
		</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-execution-listeners</span>&gt;
        &lt;<span class="hl-tag">webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"jpaFlowExecutionListener"</span> /&gt;
    &lt;<span class="hl-tag">/webflow:flow-execution-listeners</span>&gt;
&lt;<span class="hl-tag">/webflow:flow-executor</span>&gt;
	
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"jpaFlowExecutionListener"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.persistence.JpaFlowExecutionListener"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"entityManagerFactory"</span> /&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"transactionManager"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
</pre><p>
			To trigger a commit at the end, annotate your end-state with the commit attribute:
		</p><p>
</p><pre class="programlisting">
&lt;<span class="hl-tag">end-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingConfirmed"</span> <span class="hl-attribute">commit</span>=<span class="hl-value">"true"</span> /&gt;
</pre><p>		
		</p><p>
			That is it.  When your flow starts, the listener will handle allocating a new <code class="code">EntityManager</code> in <code class="code">flowScope</code>.
			Reference this EntityManager at anytime from within your flow by using the special <code class="code">persistenceContext</code> variable.
			In addition, any data access that occurs using a Spring managed data access object will use this EntityManager automatically.
			Such data access operations should always execute non transactionally or in read-only transactions to maintain isolation of intermediate edits.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="conversationScopedPersistenceContext"></a>6.4.&nbsp;ConversationScoped PersistenceContext</h2></div></div></div><p>
			This pattern creates a <code class="code">PersistenceContext</code> in <code class="code">conversationScope</code> on flow startup, and uses that context for data access until the conversation ends.
			This pattern generally employs a manual flush mode; that is, the application decides when to flush changes to the database.
			A convention for flow-managed flushing may be employed, such as always flushing after a transition one from one view-state to another.
			This pattern provides no flow-level isolation of intermediate edits since flushing synchronizes persistent object state with the database.
			With this pattern, all data access generally occurs non-transactionally.
		</p><p>
			An implementation of this flow-managed persistence pattern is not yet available in the Web Flow distribution, and will be considered for future releases.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="viewScopedPersistenceContext"></a>6.5.&nbsp;ViewState PersistenceContext</h2></div></div></div><p>
			This pattern creates a <code class="code">PersistenceContext</code> with a read-only transaction before view rendering.
			The context is used to load the model for the view.  It stays open through view rendering and commits after rendering completes.
			Then on the occurrence of an event, this pattern creates a fresh <code class="code">PersistenceContext</code> with a read-write transaction.
			The model is merged with the new context and any changes are committed after event handling completes.
			Therefore, this pattern results in edits being saved to the DB after each event.  Any rollback of intermediate flow steps requires compensating transactions.
			This pattern is often used in conjunction with an optimistic locking strategy to protect the integrity of data modified in parallel by multiple users.
			This pattern stores much less flow state, but generally increases the amount of data access since persistent entities are fetched and flushed more often.
		</p><p>
			An implementation of this flow-managed persistence pattern is not yet available in the Web Flow distribution, and will be considered for future releases.
		</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="flow-security"></a>7.&nbsp;Securing Flows</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-introduction"></a>7.1.&nbsp;Introduction</h2></div></div></div><p>
			Security is an important concept for any application.
			End users should not be able to access any portion of a site simply by guessing the URL.
			Areas of a site that are sensitive must ensure that only authorized requested are processed.
			Spring Security is a proven security platform that can integrate with your application at multiple levels.
			This section will focus on securing flow execution.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-how-to"></a>7.2.&nbsp;How do I secure a flow?</h2></div></div></div><p>
			Securing flow execution is a three step process:
			</p><div class="itemizedlist"><ul type="disc"><li><p>Configure Spring Security with authentication and authorization rules</p></li><li><p>Annotate the flow definition with the secured element to define the security rules</p></li><li><p>Add the SecurityFlowExecutionListener to process the security rules.</p></li></ul></div><p>
		</p><p>
			Each of these steps must be completed or else flow security rules will not be applied.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-secured-element"></a>7.3.&nbsp;The secured element</h2></div></div></div><p>
			The secured element designates that its containing element should apply the authorization check before fully entering.
			This may not occur more then once per stage of the flow execution that is secured.
		</p><p>
			Three phases of flow execution can be secured: flows, states and transitions.
			In each case the syntax for the secured element is identical.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-secured-element-attributes"></a>7.3.1.&nbsp;Security attributes</h3></div></div></div><p>
				The <code class="code">attributes</code> attribute is a comma separated list of Spring Security authorization attributes.
				Often, these are specific security roles.
				The attributes are compared against the user's granted attributes by a Spring Security access decision manager.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">secured</span> <span class="hl-attribute">attributes</span>=<span class="hl-value">"ROLE_USER"</span> /&gt;
			</pre><p>
				By default, a role based access decision manager is used to determine if the user is allowed access.
				This will need to be overridden if your application is not using authorization roles.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-secured-element-match"></a>7.3.2.&nbsp;Matching type</h3></div></div></div><p>
				There are two types of matching available: <code class="code">any</code> and <code class="code">all</code>.
				Any, allows access if at least one of the required security attributes is granted to the user.
				All, allows access only if each of the required security attributes are granted to the user.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">secured</span> <span class="hl-attribute">attributes</span>=<span class="hl-value">"ROLE_USER, ROLE_ANONYMOUS"</span> <span class="hl-attribute">match</span>=<span class="hl-value">"any"</span> /&gt;
			</pre><p>
				This attribute is optional.
				If not defined, the default value is <code class="code">any</code>.
			</p><p>
				The <code class="code">match</code> attribute will only be respected if the default access decision manager is used.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-listener"></a>7.4.&nbsp;The SecurityFlowExecutionListener</h2></div></div></div><p>
			Defining security rules in the flow by themselves will not protect the flow execution.
			A <code class="code">SecurityFlowExecutionListener</code> must also be defined in the webflow configuration and applied to the flow executor.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-execution-listeners</span>&gt;
        &lt;<span class="hl-tag">webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityFlowExecutionListener"</span> /&gt;
    &lt;<span class="hl-tag">/webflow:flow-execution-listeners</span>&gt;
&lt;<span class="hl-tag">/webflow:flow-executor</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityFlowExecutionListener"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.security.SecurityFlowExecutionListener"</span> /&gt;
		</pre><p>
			If access is denied to a portion of the application an <code class="code">AccessDeniedException</code> will be thrown.
			This exception will later be caught by Spring Security and used to prompt the user to authenticate.
			It is important that this exception be allowed to travel up the execution stack uninhibited, otherwise the end user may not be prompted to authenticate.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-listener-adm"></a>7.4.1.&nbsp;Custom Access Decision Managers</h3></div></div></div><p>
				If your application is using authorities that are not role based, you will need to configure a custom <code class="code">AccessDecisionManager</code>.
				You can override the default decision manager by setting the <code class="code">accessDecisionManager</code> property on the security listener.
				Please consult the <a class="ulink" href="http://static.springframework.org/spring-security/site/reference.html" target="_top">Spring Security reference documentation</a> to learn more about decision managers.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityFlowExecutionListener"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.security.SecurityFlowExecutionListener"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"accessDecisionManager"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myCustomAccessDecisionManager"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-security-configuration"></a>7.5.&nbsp;Configuring Spring Security</h2></div></div></div><p>
			Spring Security has robust configuration options available.
			As every application and environment has its own security requirements, the <a class="ulink" href="http://static.springframework.org/spring-security/site/reference.html" target="_top">Spring Security reference documentation</a> is the best place to learn the available options.
		</p><p>
			Both the <code class="code">booking-faces</code> and <code class="code">booking-mvc</code> sample applications are configured to use Spring Security.
			Configuration is needed at both the Spring and web.xml levels.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-configuration-spring"></a>7.5.1.&nbsp;Spring configuration</h3></div></div></div><p>
				The Spring configuration defines <code class="code">http</code> specifics (such as protected URLs and login/logout mechanics) and the <code class="code">authentication-provider</code>.
				For the sample applications, a local authentication provider is configured.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">security:http</span> <span class="hl-attribute">auto-config</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">security:form-login</span> <span class="hl-attribute">login-page</span>=<span class="hl-value">"/spring/login"</span> 
                         <span class="hl-attribute">login-processing-url</span>=<span class="hl-value">"/spring/loginProcess"</span>
                         <span class="hl-attribute">default-target-url</span>=<span class="hl-value">"/spring/main"</span> 
                         <span class="hl-attribute">authentication-failure-url</span>=<span class="hl-value">"/spring/login?login_error=1"</span> /&gt;  
    &lt;<span class="hl-tag">security:logout</span> <span class="hl-attribute">logout-url</span>=<span class="hl-value">"/spring/logout"</span> <span class="hl-attribute">logout-success-url</span>=<span class="hl-value">"/spring/logout-success"</span> /&gt;
&lt;<span class="hl-tag">/security:http</span>&gt;

&lt;<span class="hl-tag">security:authentication-provider</span>&gt;
    &lt;<span class="hl-tag">security:password-encoder</span> <span class="hl-attribute">hash</span>=<span class="hl-value">"md5"</span> /&gt;
    &lt;<span class="hl-tag">security:user-service</span>&gt;
        &lt;<span class="hl-tag">security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"keith"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"417c7382b16c395bc25b5da1398cf076"</span> 
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER,ROLE_SUPERVISOR"</span> /&gt;
        &lt;<span class="hl-tag">security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"erwin"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"12430911a8af075c6f41c6976af22b09"</span> 
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER,ROLE_SUPERVISOR"</span> /&gt;
        &lt;<span class="hl-tag">security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"jeremy"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"57c6cbff0d421449be820763f03139eb"</span> 
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span> /&gt;
        &lt;<span class="hl-tag">security:user</span> <span class="hl-attribute">name</span>=<span class="hl-value">"scott"</span> <span class="hl-attribute">password</span>=<span class="hl-value">"942f2339bf50796de535a384f0d1af3e"</span> 
                       <span class="hl-attribute">authorities</span>=<span class="hl-value">"ROLE_USER"</span> /&gt;
    &lt;<span class="hl-tag">/security:user-service</span>&gt;
&lt;<span class="hl-tag">/security:authentication-provider</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-security-configuration-web"></a>7.5.2.&nbsp;web.xml Configuration</h3></div></div></div><p>
				In the <code class="code">web.xml</code> file, a <code class="code">filter</code> is defined to intercept all requests.
				This filter will listen for login/logout requests and process them accordingly.
				It will also catch <code class="code">AccesDeniedException</code>s and redirect the user to the login page.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">filter</span>&gt;
    &lt;<span class="hl-tag">filter-name</span>&gt;springSecurityFilterChain&lt;<span class="hl-tag">/filter-name</span>&gt;
    &lt;<span class="hl-tag">filter-class</span>&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;<span class="hl-tag">/filter-class</span>&gt;
&lt;<span class="hl-tag">/filter</span>&gt;

&lt;<span class="hl-tag">filter-mapping</span>&gt;
    &lt;<span class="hl-tag">filter-name</span>&gt;springSecurityFilterChain&lt;<span class="hl-tag">/filter-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;
			</pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="flow-inheritance"></a>8.&nbsp;Flow Inheritance</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-introduction"></a>8.1.&nbsp;Introduction</h2></div></div></div><p>
			Flow inheritance allows one flow to inherit the configuration of another flow.
			Inheritance can occur at both the flow and state levels.
			A common use case is for a parent flow to define global transitions and exception handlers, then each child flow can inherit those settings.
		</p><p>
			In order for a parent flow to be found, it must be added to the <code class="code">flow-registry</code> just like any other flow.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-java-comparison"></a>8.2.&nbsp;Is flow inheritance like Java inheritance?</h2></div></div></div><p>
			Flow inheritance is similar to Java inheritance in that elements defined in a parent are exposed via the child, however, there are key differences.
		</p><p>
			A child flow cannot override an element from a parent flow.
			Similar elements between the parent and child flows will be merged.
			Unique elements in the parent flow will be added to the child.
		</p><p>
			A child flow can inherit from multiple parent flows.
			Java inheritance is limited to a single class.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-levels"></a>8.3.&nbsp;Types of Flow Inheritance</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-level-flow"></a>8.3.1.&nbsp;Flow level inheritance</h3></div></div></div><p>
				Flow level inheritance is defined by the <code class="code">parent</code> attribute on the <code class="code">flow</code> element.
				The attribute contains a comma separated list of flow identifiers to inherit from.
				The child flow will inherit from each parent in the order it is listed adding elements and content to the resulting flow.
				The resulting flow from the first merge will be considered the child in the second merge, and so on.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"common-transitions, common-states"</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-level-state"></a>8.3.2.&nbsp;State level inheritance</h3></div></div></div><p>
				State level inheritance is similar to flow level inheritance, except only one state inherits from the parent, instead of the entire flow.
			</p><p>
				Unlike flow inheritance, only a single parent is allowed.
				Additionally, the identifier of the flow state to inherit from must also be defined.
				The identifiers for the flow and the state within that flow are separated by a #. 
			</p><p>
				The parent and child states must be of the same type.
				For instance a view-state cannot inherit from an end-state, only another view-state.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"child-state"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"parent-flow#parent-view-state"</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-abstract"></a>8.4.&nbsp;Abstract flows</h2></div></div></div><p>
			Often parent flows are not designed to be executed directly.
			In order to protect these flows from running, they can be marked as <code class="code">abstract</code>.
			If an abstract flow attempts to run, a <code class="code">FlowBuilderException</code> will be thrown.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">flow</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">"true"</span>&gt;
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-inheritance-algorithm"></a>8.5.&nbsp;Inheritance Algorithm</h2></div></div></div><p>
			When a child flow inherits from it's parent, essentially what happens is that the parent and child are merged together to create a new flow.
			There are rules for every element in the Web Flow definition language that govern how that particular element is merged.
		</p><p>
			There are two types of elements: <span class="emphasis"><em>mergeable</em></span> and <span class="emphasis"><em>non-mergeable</em></span>.
			Mergeable elements will always attempt to merge together if the elements are similar.
			Non-mergeable elements in a parent or child flow will always be contained in the resulting flow intact.
			They will not be modified as part of the merge process.
		</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
			Paths to external resources in the parent flow should be absolute.
			Relative paths will break when the two flows are merged unless the parent and child flow are in the same directory.
			Once merged, all relative paths in the parent flow will become relative to the child flow.
		</td></tr></table></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-algorithm-mergeable"></a>8.5.1.&nbsp;Mergeable Elements</h3></div></div></div><p>
				If the elements are of the same type and their keyed attribute are identical, the content of the parent element will be merged with the child element.
				The merge algorithm will continue to merge each sub-element of the merging parent and child.
				Otherwise the parent element is added as a new element to the child. 
			</p><p>
				In most cases, elements from a parent flow that are added will be added after elements in the child flow.
				Exceptions to this rule include action elements (evaluate, render and set) which will be added at the beginning.
				This allows for the results of parent actions to be used by child actions.
			</p><p>
				Mergeable elements are:
				</p><div class="itemizedlist"><ul type="disc"><li><p>action-state: id</p></li><li><p>attribute: name</p></li><li><p>decision-state: id</p></li><li><p>end-state: id</p></li><li><p>flow: always merges</p></li><li><p>if: test</p></li><li><p>on-end: always merges</p></li><li><p>on-entry: always merges</p></li><li><p>on-exit: always merges</p></li><li><p>on-render: always merges</p></li><li><p>on-start: always merges</p></li><li><p>input: name</p></li><li><p>output: name</p></li><li><p>secured: attributes</p></li><li><p>subflow-state: id</p></li><li><p>transition: on</p></li><li><p>view-state: id</p></li></ul></div><p>
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-inheritance-nonmergeable"></a>8.5.2.&nbsp;Non-mergeable Elements</h3></div></div></div><p>
				Non-mergeable elements are:
				</p><div class="itemizedlist"><ul type="disc"><li><p>bean-import</p></li><li><p>evaluate</p></li><li><p>exception-handler</p></li><li><p>persistence-context</p></li><li><p>render</p></li><li><p>set</p></li><li><p>var</p></li></ul></div><p>
			</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="system-setup"></a>9.&nbsp;System Setup</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-setup-introduction"></a>9.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows you how to setup the Web Flow system for use in any web environment.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-schema"></a>9.2.&nbsp;webflow-config.xsd</h2></div></div></div><p>
			Web Flow provides a Spring schema that allows you to configure the system.
			To use this schema, include it in one of your infrastructure-layer beans files:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config-2.0.xsd"</span>&gt;		

    &lt;<span class="hl-comment">!-- Setup Web Flow here --</span>&gt;
	
&lt;<span class="hl-tag">/beans</span>&gt;
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-config-basic"></a>9.3.&nbsp;Basic system configuration</h2></div></div></div><p>
			The next section shows the minimal configuration required to set up the Web Flow system in your application.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-registry"></a>9.3.1.&nbsp;FlowRegistry</h3></div></div></div><p>
				Register your flows in a <code class="code">FlowRegistry</code>:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> /&gt;
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="basic-setup-flow-executor"></a>9.3.2.&nbsp;FlowExecutor</h3></div></div></div><p>
				Deploy a FlowExecutor, the central service for executing flows:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
			</pre></div><p>
			See the Spring MVC and Spring Faces sections of this guide on how to integrate the Web Flow system with the MVC and JSF environment, respectively.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-registry"></a>9.4.&nbsp;flow-registry options</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-builder-services"></a>9.4.1.&nbsp;Configuring custom FlowBuilder services</h3></div></div></div><p>
				Use the <code class="code">flow-builder-services</code> attribute to customize the services used to build the flows in a registry.
				If no flow-builder-services tag is specified, the default service implementations are used.
				When the tag is defined, you only need to reference the services you want to customize.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> /&gt;
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;

&lt;<span class="hl-tag">webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> /&gt;
			</pre><p>
				The configurable services are the <code class="code">conversion-service</code>, <code class="code">expression-parser</code>, and <code class="code">view-factory-creator</code>.
				These services are configured by referencing custom beans you define.  For example:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span>
    <span class="hl-attribute">conversion-service</span>=<span class="hl-value">"conversionService"</span>
    <span class="hl-attribute">expression-parser</span>=<span class="hl-value">"expressionParser"</span>
    <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"viewFactoryCreator"</span> /&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"conversionService"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> /&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"expressionParser"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> /&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"..."</span> /&gt;
			</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-conversion"></a>9.4.1.1.&nbsp;conversion-service</h4></div></div></div><p>
					Use the <code class="code">conversion-service</code> attribute to customize the <code class="code">ConversionService</code> used by the Web Flow system.
					Converters are used to convert from one type to another when required during flow execution.
					The default ConversionService registers converters for your basic object types such as numbers, classes, and enums.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-expression-parser"></a>9.4.1.2.&nbsp;expression-parser</h4></div></div></div><p>
					Use the <code class="code">expression-parser</code> attribute to customize the <code class="code">ExpressionParser</code> used by the Web Flow system.
					The default ExpressionParser uses the Unified EL if available on the classpath, otherwise OGNL is used.			
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="builder-service-view-factory-creator"></a>9.4.1.3.&nbsp;view-factory-creator</h4></div></div></div><p>
					Use the <code class="code">view-factory-creator</code> attribute to customize the <code class="code">ViewFactoryCreator</code> used by the Web Flow system.
					The default ViewFactoryCreator produces Spring MVC ViewFactories capable of rendering JSP, Velocity, and Freemarker views.
				</p></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-parent"></a>9.4.2.&nbsp;Configuring FlowRegistry hierarchies</h3></div></div></div><p>
				Use the <code class="code">parent</code> attribute to link two flow registries together in a hierarchy.
				When the child registry is queried, if it cannot find the requested flow it will delegate to its parent.
			</p><pre class="programlisting">
&lt;<span class="hl-comment">!-- my-system-config.xml --</span>&gt;
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">parent</span>=<span class="hl-value">"sharedFlowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> /&gt;
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;

&lt;<span class="hl-comment">!-- shared-config.xml --</span>&gt;
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"sharedFlowRegistry"</span>&gt;
    &lt;<span class="hl-tag">--</span> <span class="hl-attribute">Global</span> <span class="hl-attribute">flows</span> <span class="hl-attribute">shared</span> <span class="hl-attribute">by</span> <span class="hl-attribute">several</span> <span class="hl-attribute">applications</span> <span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;/webflow:flow-registry&gt;</span>
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location"></a>9.4.3.&nbsp;Specifying flow locations</h3></div></div></div><p>
				Use the <code class="code">location</code> element to specify paths to flow definitions to register.
				By default, flows will be assigned registry identifiers equal to their filenames minus the file extension.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-id"></a>9.4.4.&nbsp;Assigning custom flow identifiers</h3></div></div></div><p>
				Specify an id to assign a custom registry identifier to a flow:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookHotel"</span> /&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-location-attributes"></a>9.4.5.&nbsp;Assigning flow meta-attributes</h3></div></div></div><p>
				Use the <code class="code">flow-definition-attributes</code> element to assign custom meta-attributes to a registered flow:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span>&gt;
    &lt;<span class="hl-tag">flow-definition-attributes</span>&gt;
        &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"caption"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Books a hotel"</span> /&gt;
        &lt;<span class="hl-tag">attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"persistence-context"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">type</span>=<span class="hl-value">"boolean"</span> /&gt;
    &lt;<span class="hl-tag">/flow-definition-attributes</span>&gt;
&lt;<span class="hl-tag">/webflow:flow-location</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-registry-patterns"></a>9.4.6.&nbsp;Registering flows using a location pattern</h3></div></div></div><p>
				Use the <code class="code">flow-location-patterns</code> element to register flows that match a specific resource location pattern:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-location-pattern</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/flows/**/*-flow.xml"</span> /&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="flow-executor"></a>9.5.&nbsp;flow-executor options</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="flow-executor-execution-listeners"></a>9.5.1.&nbsp;Attaching flow execution listeners</h3></div></div></div><p>
				Use the <code class="code">flow-execution-listeners</code> element to register listeners that observe the lifecycle of flow executions:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow-execution-listeners</span>&gt;
    &lt;<span class="hl-tag">listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span>/&gt;
    &lt;<span class="hl-tag">listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"persistenceListener"</span>/&gt;
&lt;<span class="hl-tag">/flow-execution-listeners</span>&gt;
			</pre><p>
				You may also configure a listener to observe only certain flows:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityListener"</span> <span class="hl-attribute">criteria</span>=<span class="hl-value">"securedFlow1,securedFlow2"</span>/&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="tuning-flow-execution-repository"></a>9.5.2.&nbsp;Tuning FlowExecution persistence</h3></div></div></div><p>
				Use the <code class="code">flow-execution-repository</code> element to tune flow execution persistence settings:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">flow-execution-repository</span> <span class="hl-attribute">max-executions</span>=<span class="hl-value">"5"</span> <span class="hl-attribute">max-execution-snapshots</span>=<span class="hl-value">"30"</span> /&gt;
			</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-executions"></a>9.5.2.1.&nbsp;max-executions</h4></div></div></div><p>
					Tune the <code class="code">max-executions</code> attribute to place a cap on the number of flow executions that can be created per user session.
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="repository-max-snapshots"></a>9.5.2.2.&nbsp;max-execution-snapshots</h4></div></div></div><p>
					Tune the <code class="code">max-execution-snapshots</code> attribute to place a cap on the number of history snapshots that can be taken per flow execution.
					To disable snapshotting, set this value to 0.  To enable an unlimited number of snapshots, set this value to -1. 
				</p></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring-mvc"></a>10.&nbsp;Spring MVC Integration</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-introduction"></a>10.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows how to integrate Web Flow into a Spring MVC web application.
			The <code class="code">booking-mvc</code> sample application is a good reference for Spring MVC with Web Flow.
			This application is a simplified travel site that allows users to search for and book hotel rooms.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-web.xml"></a>10.2.&nbsp;Configuring web.xml</h2></div></div></div><p>
			The first step to using Spring MVC is to configure the <code class="code">DispatcherServlet</code> in <code class="code">web.xml</code>.
			You typically do this once per web application.
		</p><p>
 			The example below maps all requests that begin with <code class="code">/spring/</code> to the DispatcherServlet.
			An <code class="code">init-param</code> is used to provide the <code class="code">contextConfigLocation</code>.
			This is the configuration file for the web application.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">init-param</span>&gt;
        &lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
        &lt;<span class="hl-tag">param-value</span>&gt;/WEB-INF/web-application-config.xml&lt;<span class="hl-tag">/param-value</span>&gt;
    &lt;<span class="hl-tag">/init-param</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;
	
&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/spring/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-spring-url-mapping"></a>10.3.&nbsp;Mapping URLs to Flows</h2></div></div></div><p>
			The <code class="code">DispatcherServlet</code> maps request URLs to handlers.
			A simple way to create URL mapping rules is to define a <code class="code">SimpleUrlHandlerMapping</code>:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowUrlMappings"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;
            /hotels/booking=bookingFlowHandler
        &lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
		</pre><p>
			The example above maps the servlet-relative request URL <code class="code">/hotels/booking</code> to the <code class="code">bookingFlowHandler</code>.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-flow-handlers"></a>10.4.&nbsp;Flow Handlers</h2></div></div></div><p>
			A <code class="code">FlowHandler</code> manages executions of a single flow definition.
			A <code class="code">FlowHandler</code> is responsible for:
		</p><div class="itemizedlist"><ul type="disc"><li><p>Providing the <code class="code">id</code> of the flow definition to execute</p></li><li><p>Creating the input to pass new flow executions</p></li><li><p>Handling flow execution outcomes</p></li><li><p>Handling flow execution exceptions</p></li></ul></div><p>
			These responsibilities are illustrated in the definition of the <code class="code">org.springframework.mvc.servlet.FlowHandler</code> interface:
		</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FlowHandler {

    <span class="hl-keyword">public</span> String getFlowId();

    <span class="hl-keyword">public</span> MutableAttributeMap createExecutionInputMap(HttpServletRequest request);

    <span class="hl-keyword">public</span> String handleExecutionOutcome(FlowExecutionOutcome outcome,
        HttpServletRequest request, HttpServletResponse response);

    <span class="hl-keyword">public</span> String handleException(FlowException e,
        HttpServletRequest request, HttpServletResponse response);
}				
		</pre><p>
			To implement a FlowHandler, subclass <code class="code">AbstractFlowHandler</code>.  You only need to override the methods that you need.
			Specifically:
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					Override <code class="code">getFlowId(HttpServletRequest)</code> when the id of your flow cannot be derived from the URL.
					By default, the flow id is derived from the last path element in the request URI, before any query parameters.
					For example, <code class="code">http://localhost/hotels/booking?hotelId=1</code> results in a flow id of <code class="code">booking</code> by default.
				</p></li><li><p>
					Override <code class="code">createExecutionInputMap(HttpServletRequest)</code> when you need fine-grained control over extracting
					flow input parameters from the HttpServletRequest.  By default, all request parameters are treated as flow input parameters.
				</p></li><li><p>
					Override <code class="code">handleExecutionOutcome</code> when you need to handle specific flow execution outcomes in a custom manner.
					The default behavior sends a redirect to the ended flow's URL to restart a new execution of the flow.
				</p></li><li><p>
					Override <code class="code">handleException</code> when you need fine-grained control over unhandled flow exceptions.
					The default behavior attempts to restart the flow when a client attempts to access an ended or expired flow execution.
					Any other exception is rethrown to the Spring MVC ExceptionResolver infrastructure by default.
				</p></li></ul></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-flow-handler-example"></a>10.4.1.&nbsp;Example FlowHandler</h3></div></div></div><p>
				A common interaction pattern between Spring MVC And Web Flow is for a Flow to redirect to a Controller when it ends.
				FlowHandlers allow this to be done without coupling the flow definition with a specific controller URL.
				An example FlowHandler that redirects to a Spring MVC Controller is shown below:
			</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingFlowHandler <span class="hl-keyword">extends</span> AbstractFlowHandler {
    <span class="hl-keyword">public</span> String handleExecutionOutcome(FlowExecutionOutcome outcome,
                                         HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-keyword">if</span> (outcome.getId().equals(<span class="hl-string">"bookingConfirmed"</span>)) {
            <span class="hl-keyword">return</span> <span class="hl-string">"/booking/show?bookingId="</span> + outcome.getOutput().get(<span class="hl-string">"bookingId"</span>);
        } <span class="hl-keyword">else</span> {
            <span class="hl-keyword">return</span> <span class="hl-string">"/hotels/index"</span>;
        }
    }
}
			</pre><p>
				Since this handler only needs to handle flow execution outcomes in a custom manner, nothing else is overridden.
				The <code class="code">bookingConfirmed</code> outcome will result in a redirect to show the new booking.
				Any other outcome will redirect back to the hotels index page.
			</p><p>
				To use your FlowHandler, first deploy an instance to Spring so it can be mapped to a URL:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookingFlowHandler"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.BookingFlowHandler"</span> /&gt;
			</pre><p>
				Then add the URL mapping rule:
			</p><pre class="programlisting">
&lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span>&gt;
    &lt;<span class="hl-tag">value</span>&gt;
        /hotels/booking=bookingFlowHandler
    &lt;<span class="hl-tag">/value</span>&gt;
&lt;<span class="hl-tag">/property</span>&gt;
			</pre><p>
				With this configuration, accessing the URL <code class="code">/hotels/booking</code> will launch the <code class="code">booking</code> flow.
				When the booking flow ends, the FlowHandler will process the flow execution outcome and redirect to the appropriate controller.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-flow-handler-adapter"></a>10.4.2.&nbsp;Registering the FlowHandlerAdapter</h3></div></div></div><p>
				To enable flow handlers, make sure you define the special <code class="code">FlowHandlerAdapter</code>.  You only need to do this once.
			</p><pre class="programlisting">
&lt;<span class="hl-comment">!-- Enables FlowHandler URL mapping --</span>&gt;
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowHandlerAdapter"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-mvc-flow-handler-redirects"></a>10.4.3.&nbsp;FlowHandler Redirects</h3></div></div></div><p>
				A FlowHandler handling a FlowExecutionOutcome or FlowException returns a <code class="code">String</code> to indicate the resource to redirect to after handling.
				In the previous example, the <code class="code">BookingFlowHandler</code> redirects to the <code class="code">booking/show</code> resource URI for <code class="code">bookingConfirmed</code> outcomes,
				and the <code class="code">hotels/index</code> resource URI for all other outcomes. 
			</p><p>
				By default, returned resource locations are relative to the current servlet mapping.
				This allows for a flow handler to redirect to other Controllers in the application using relative paths.
				In addition, explicit redirect prefixes are supported for cases where more control is needed.
			</p><p>
				The explicit redirect prefixes supported are:
			</p><div class="itemizedlist"><ul type="disc"><li><p><code class="code">servletRelative:</code> - redirect to a resource relative to the current servlet</p></li><li><p><code class="code">contextRelative:</code> - redirect to a resource relative to the current web application context path</p></li><li><p><code class="code">serverRelative:</code> - redirect to a resource relative to the server root</p></li><li><p><code class="code">http://</code> or <code class="code">https://</code> - redirect to a fully-qualified resource URI</p></li></ul></div><p>
				These same redirect prefixes are also supported within a flow definition when using the <code class="code">externalRedirect:</code> directive in
				conjunction with a view-state or end-state; for example, <code class="code">view="externalRedirect:http://springframework.org"</code>
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-spring-flow-controllers"></a>10.5.&nbsp;Flow Controller</h2></div></div></div><p>
			With the FlowHandler MVC integration approach, you define one handler per flow.
			This is overkill in the cases where default flow handling rules are sufficient.
		</p><p>
			For simple cases, consider using the <code class="code">FlowController</code> to map flow requests to a single handler.
			You only have to configure this controller once and it will apply the flow handling defaults outlined in the previous section.
			Also, you can still override these defaults by configuring the controller's <code class="code">flowHandlers</code> property.
		</p><p>
			Below is a typical <code class="code">FlowController</code> definition:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowController"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowController"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
		</pre><p>
			Below illustrates several URLs mapped to this controller:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowUrlMappings"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"mappings"</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;
            /login=flowController
            /hotels/booking=flowController
        &lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
		</pre><p>
			With this configuration, accessing <code class="code">/login</code> launches the login flow.
			Accessing <code class="code">/hotels/booking</code> launches the booking flow.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-mvc-config-spring-view-resolution"></a>10.6.&nbsp;View Resolution</h2></div></div></div><p>
			Web Flow 2 maps selected view identifiers to files located within the flow's working directory unless otherwise specified.
			For existing Spring MVC + Web Flow applications, an external <code class="code">ViewResolver</code> is likely already handling this mapping for you.
			Therefore, to continue using that resolver and to avoid having to change how your existing flow views are packaged, configure Web Flow as follows:
		</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span>&gt;
    &lt;<span class="hl-tag">flow:location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/hotels/booking/booking.xml"</span> /&gt;
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;

&lt;<span class="hl-tag">webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"mvcViewFactoryCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mvcViewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.builder.MvcViewFactoryCreator"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewResolvers"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"myExistingViewResolverToUseForFlows"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
		</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring-js"></a>11.&nbsp;Spring JavaScript Quick Reference</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-introduction"></a>11.1.&nbsp;Introduction</h2></div></div></div><p>
            Spring Javascript (spring-js) is a lightweight abstraction over common JavaScript toolkits such as Dojo.
            It aims to provide a common client-side programming model for progressively enhancing a web page with rich widget behavior and Ajax remoting.
        </p><p>
            Use of the Spring JS API is demonstrated in the the Spring MVC + Web Flow version of the Spring Travel reference application.
            In addition, the JSF components provided as part of the Spring Faces library build on Spring.js.
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-resource-servlet"></a>11.2.&nbsp;Serving Javascript Resources</h2></div></div></div><p>
            Spring JS provides a generic <code class="code">ResourceServlet</code> to serve web resources such as JavaScript and CSS files from jar files, as well as the webapp root directory.
            This servlet provides a convenient way to serve Spring.js files to your pages.
            To deploy this servlet, declare the following in <code class="code">web.xml</code>:
        </p><pre class="programlisting">
&lt;<span class="hl-comment">!-- Serves static resource content from .jar files such as spring-js.jar --</span>&gt;
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Resource Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.js.resource.ResourceServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;
        
&lt;<span class="hl-comment">!-- Map all /resources requests to the Resource Servlet for handling --</span>&gt;
&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Resource Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/resources/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-includes"></a>11.3.&nbsp;Including Spring Javascript in a Page</h2></div></div></div><p>
            Spring JS is designed such that an implementation of its API can be built for any of the popular Javascript toolkits.
            The initial implementation of Spring.js builds on the Dojo toolkit.
        </p><p>
            Using Spring Javascript in a page requires including the underlying toolkit as normal,
            the <code class="code">Spring.js</code> base interface file, and the <code class="code">Spring-(library implementation).js</code> file for the underlying toolkit.
            As an example, the following includes obtain the Dojo implementation of Spring.js using the <code class="code">ResourceServlet</code>:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span>/resources/dojo/dojo.js" /&gt;"&gt; &lt;<span class="hl-tag">/script</span>&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span>/resources/spring/Spring.js" /&gt;"&gt; &lt;<span class="hl-tag">/script</span>&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span> <span class="hl-attribute">src</span>=<span class="hl-value">"&lt;c:url value="</span>/resources/spring/Spring-Dojo.js" /&gt;"&gt; &lt;<span class="hl-tag">/script</span>&gt;
        </pre><p>
            When using the widget system of an underlying library, typically you must also include some CSS resources to obtain the desired look and feel.
            For the booking-mvc reference application, Dojo's <code class="code">tundra.css</code> is included:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">link</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/css"</span> <span class="hl-attribute">rel</span>=<span class="hl-value">"stylesheet"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"&lt;c:url value="</span>/resources/dijit/themes/tundra/tundra.css" /&gt;" /&gt;
        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-decorations"></a>11.4.&nbsp;Spring Javascript Decorations</h2></div></div></div><p>
            A central concept in Spring Javascript is the notion of applying decorations to existing DOM nodes.
            This technique is used to progressively enhance a web page such that the page will still be functional in a less capable browser.
            The <code class="code">addDecoration</code> method is used to apply decorations.
        </p><p>
	         The following example illustrates enhancing a Spring MVC <code class="code">&lt;form:input&gt;</code> tag with rich suggestion behavior:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">form:input</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchString"</span> <span class="hl-attribute">path</span>=<span class="hl-value">"searchString"</span>/&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span>&gt;
    Spring.addDecoration(new Spring.ElementDecoration({
        elementId: "searchString",
        widgetType: "dijit.form.ValidationTextBox",
        widgetAttrs: { promptMessage : "Search hotels by name, address, city, or zip." }}));
&lt;<span class="hl-tag">/script</span>&gt;
        </pre><p>
            The <code class="code">ElementDecoration</code> is used to apply rich widget behavior to an existing DOM node.
            This decoration type does not aim to completely hide the underlying toolkit, so the toolkit's native widget type and attributes are used directly.
            This approach allows you to use a common decoration model to integrate any widget from the underlying toolkit in a consistent manner.
            See the <code class="code">booking-mvc</code> reference application for more examples of applying decorations to do things from suggestions to client-side validation.
        </p><p>
            When using the <code class="code">ElementDecoration</code> to apply widgets that have rich validation behavior, a common need is to prevent the form from being submitted to the server until validation passes.
            This can be done with the <code class="code">ValidateAllDecoration</code>:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_proceed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span> /&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span>&gt;
    Spring.addDecoration(new Spring.ValidateAllDecoration({ elementId:'proceed', event:'onclick' }));
&lt;<span class="hl-tag">/script</span>&gt;
        </pre><p>
            This decorates the "Proceed" button with a special onclick event handler that fires the client side validators and does not allow the form to submit until they pass successfully.
        </p><p>
            An <code class="code">AjaxEventDecoration</code> applies a client-side event listener that fires a remote Ajax request to the server.  It also auto-registers a callback function to link in the response:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">a</span> <span class="hl-attribute">id</span>=<span class="hl-value">"prevResultsLink"</span> <span class="hl-attribute">href</span>=<span class="hl-value">"search?searchString=${searchCriteria.searchString}&amp;page=${searchCriteria.page - 1}"</span>&gt;Previous Results&lt;<span class="hl-tag">/a</span>&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span>&gt;
    Spring.addDecoration(new Spring.AjaxEventDecoration({
        elementId: "prevResultsLink",
        event: "onclick",
        params: { fragments: "body" }
    }));
&lt;<span class="hl-tag">/script</span>&gt;
        </pre><p>
            This decorates the onclick event of the "Previous Results" link with an Ajax call, passing along a special parameter that specifies the fragment to be re-rendered in the response.
            Note that this link would still be fully functional if Javascript was unavailable in the client.
            (See the section on <a class="link" href="#spring-js-ajax" title="11.5.&nbsp;Handling Ajax Requests">Handling Ajax Requests</a> for details on how this request is handled on the server.)
        </p><p>
            Sometimes it is necessary to call Spring Javascript's <code class="code">RemotingHandler</code> directly instead of using the <code class="code">AjaxEventDecoration</code>.
            For example, see inline <code class="code">onclick</code> handler of this button:
        </p><pre class="programlisting">
&lt;<span class="hl-tag">input</span> <span class="hl-attribute">type</span>=<span class="hl-value">"submit"</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">name</span>=<span class="hl-value">"_eventId_proceed"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span> 
       <span class="hl-attribute">onclick</span>=<span class="hl-value">"Spring.remoting.submitForm('proceed', 'booking', { fragments:'messages,bookingForm' }); return false;"</span> /&gt;
&lt;<span class="hl-tag">script</span> <span class="hl-attribute">type</span>=<span class="hl-value">"text/javascript"</span>&gt;
    Spring.addDecoration(new Spring.ValidateAllDecoration({ elementId:'proceed', event:'onclick'} ));
&lt;<span class="hl-tag">/script</span>&gt;
        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-js-ajax"></a>11.5.&nbsp;Handling Ajax Requests</h2></div></div></div><p>
            Spring Javascript's client-side Ajax response handling is built upon the notion of receiving "fragments" back from the server.
            These fragments are just standard HTML that is meant to replace portions of the existing page.
            The key piece needed on the server is a way to determine which pieces of a full response need to be pulled out for partial rendering.
        </p><p>
            In order to be able to render partial fragments of a full response, the full response must be built using a
            templating technology that allows the use of composition for constructing the response, and for the member
            parts of the composition to be referenced and rendered individually.
            Spring Javascript provides some simple Spring MVC extensions that make use of Tiles to achieve this.
            The same technique could theoretically be used with any templating system supporting composition.
        </p><p>
            Spring Javascript's Ajax remoting functionality is built upon the notion that the core handling code for an
            Ajax request should not differ from a standard browser request, thus no special knowledge of an Ajax request
            is needed directly in the code and the same hanlder can be used for both styles of request.
        </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-js-ajax-mvc"></a>11.5.1.&nbsp;Handling Ajax Requests with Spring MVC Controllers</h3></div></div></div><p>
                In order to handle Ajax requests with Spring MVC controllers, all that is needed is the configuration of
                the provided Spring MVC extensions in your Spring application context for rendering the partial response
                (note that these extensions require the use of Tiles for templating):
            </p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tilesViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.js.ajax.AjaxUrlBasedViewResolver"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.webflow.mvc.view.FlowAjaxTilesView"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
            </pre><p>
                This configures the <code class="code">AjaxUrlBasedViewResolver</code> which in turn interprets Ajax requests and creates <code class="code">FlowAjaxTilesView</code> objects to handle rendering of the appropriate fragments.
                Note that <code class="code">FlowAjaxTilesView</code> is capable of handling the rendering for both Web Flow and pure Spring MVC requests.
                The fragments correspond to individual attributes of a Tiles view definition. For example, take the following Tiles view definition:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">definition</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotels/index"</span> <span class="hl-attribute">extends</span>=<span class="hl-value">"standardLayout"</span>&gt;
    &lt;<span class="hl-tag">put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"body"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"index.body"</span> /&gt;
&lt;<span class="hl-tag">/definition</span>&gt;

&lt;<span class="hl-tag">definition</span> <span class="hl-attribute">name</span>=<span class="hl-value">"index.body"</span> <span class="hl-attribute">template</span>=<span class="hl-value">"/WEB-INF/hotels/index.jsp"</span>&gt;
    &lt;<span class="hl-tag">put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"hotelSearchForm"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/hotels/hotelSearchForm.jsp"</span> /&gt;
    &lt;<span class="hl-tag">put-attribute</span> <span class="hl-attribute">name</span>=<span class="hl-value">"bookingsTable"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/hotels/bookingsTable.jsp"</span> /&gt;
&lt;<span class="hl-tag">/definition</span>&gt;
            </pre><p>
                An Ajax request could specify the "body", "hotelSearchForm" or "bookingsTable" to be rendered as fragments in the request.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-js-ajax-mvc-webflow"></a>11.5.2.&nbsp;Handling Ajax Requests with Spring MVC + Spring Web Flow</h3></div></div></div><p>
                Spring Web Flow handles the optional rendering of fragments directly in the flow definition language through use of the <code class="code">render</code> element.
                The benefit of this approach is that the selection of fragments is completely decoupled from client-side code, such that no special parameters need to be passed with the request the way they
                currently must be with the pure Spring MVC controller approach.
                For example, if you wanted to render the "hotelSearchForm" fragment from the previous example Tiles view into a rich Javascript popup: 
            </p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">on-entry</span>&gt;
        &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotelSearchForm"</span> /&gt;
    &lt;<span class="hl-tag">/on-entry</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"search"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotels"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.resetPage()"</span>/&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;                
            </pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="spring-faces"></a>12.&nbsp;JSF Integration</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-introduction"></a>12.1.&nbsp;Introduction</h2></div></div></div><p>
            Spring Faces is Spring's JSF integration module that simplifies using JSF with Spring. It lets you use the
            JSF UI Component Model with Spring MVC and Spring Web Flow controllers.
        </p><p>
            Spring Faces also includes a small Facelets component library that provides Ajax and client-side validation
            capabilities. This component library builds on Spring Javascript, a Javascript abstraction framework that
            integrates Dojo as the underlying UI toolkit.
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-integration"></a>12.2.&nbsp;Spring-centric Integration Approach</h2></div></div></div><p>
            Spring Faces combines the strengths of JSF, its UI component model, with the strengths of Spring, its
            controller and configuration model. This brings you all the strengths of JSF without any of the weaknesses.
        </p><p>
            Spring Faces provides a powerful supplement to a number of the standard JSF facilities, including:
            </p><div class="orderedlist"><ol type="1"><li>managed bean facility</li><li>scope management</li><li>event handling</li><li>navigation rules</li><li>easy modularization and packaging of views</li><li>cleaner URLs</li><li>model-level validation</li><li>client-side validation and UI enhancement</li><li>Ajax partial page updates and full navigation</li><li>progressive enhancement and graceful degradation</li></ol></div><p>

            Using these features will significantly reduce the amount of configuration required in faces-config.xml
            while providing a cleaner separation between the view and controller layer and better modularization of your
            application's functional responsibilities. These use of these features are outlined in the sections to
            follow. As the majority of these features build on the flow definition language of Spring Web Flow, it is
            assumed that you have an understanding of the foundations presented in
            <a class="link" href="#defining-flows" title="2.&nbsp;Defining Flows">Defining Flows</a>
            .
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-config-web.xml"></a>12.3.&nbsp;Configuring web.xml</h2></div></div></div><p>
            The first step to using Spring Faces is to route requests to the
            <code class="code">DispatcherServlet</code>
            in the
            <code class="code">web.xml</code>
            file. In this example, we map all URLs that begin with
            <code class="code">/spring/</code>
            to the servlet. The servlet needs to be configured. An
            <code class="code">init-param</code>
            is used in the servlet to pass the
            <code class="code">contextConfigLocation</code>
            . This is the location of the Spring configuration for your application.
        </p><pre class="programlisting">
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.DispatcherServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">init-param</span>&gt;
        &lt;<span class="hl-tag">param-name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/param-name</span>&gt;
        &lt;<span class="hl-tag">param-value</span>&gt;/WEB-INF/web-application-config.xml&lt;<span class="hl-tag">/param-value</span>&gt;
    &lt;<span class="hl-tag">/init-param</span>&gt;
    &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;
    
&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/spring/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
        </pre><p>
            In order for JSF to bootstrap correctly, the
            <code class="code">FacesServlet</code>
            must be configured in
            <code class="code">web.xml</code>
            as it normally would even though you generally will not need to route requests through it at all when using
            Spring Faces.
        </p><pre class="programlisting">
&lt;<span class="hl-comment">!-- Just here so the JSF implementation can initialize, *not* used at runtime --</span>&gt;
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Faces Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;javax.faces.webapp.FacesServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;
    
&lt;<span class="hl-comment">!-- Just here so the JSF implementation can initialize --</span>&gt;
&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Faces Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;*.faces&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
        </pre><p>
            When using the Spring Faces components, you also need to configure the Spring JavaScript
            <code class="code">ResourceServlet</code>
            so that CSS and JavaScript resources may be output correctly by the components. This servlet must be mapped
            to /resources/* in order for the URL's rendered by the components to function correctly.
        </p><pre class="programlisting">
&lt;<span class="hl-comment">!-- Serves static resource content from .jar files such as spring-faces.jar --</span>&gt;
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Resource Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.js.resource.ResourceServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">load-on-startup</span>&gt;0&lt;<span class="hl-tag">/load-on-startup</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;
        
&lt;<span class="hl-comment">!-- Map all /resources requests to the Resource Servlet for handling --</span>&gt;
&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Resource Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/resources/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
        </pre><p>
            The Spring Faces components require the use of Facelets instead of JSP, so the typical Facelets
            configuration must be added as well when using these components.
        </p><pre class="programlisting">
!-- Use JSF view templates saved as *.xhtml, for use with Facelets --&gt;
&lt;<span class="hl-tag">context-param</span>&gt;
    &lt;<span class="hl-tag">param-name</span>&gt;javax.faces.DEFAULT_SUFFIX&lt;<span class="hl-tag">/param-name</span>&gt;
    &lt;<span class="hl-tag">param-value</span>&gt;.xhtml&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;
        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-webflow-config"></a>12.4.&nbsp;Configuring Web Flow to render JSF views</h2></div></div></div><p>
            The next step is to configure Web Flow to render JSF views. To do this, in your Spring Web Flow
            configuration include the
            <code class="code">faces</code>
            namespace and link in the faces
            <code class="code">flow-builder-services</code>
            :
        </p><pre class="programlisting">
&lt;<span class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
       <span class="hl-attribute">xmlns:faces</span>=<span class="hl-value">"http://www.springframework.org/schema/faces"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config-2.0.xsd
           http://www.springframework.org/schema/faces
           http://www.springframework.org/schema/faces/spring-faces-2.0.xsd"</span>&gt;

	&lt;<span class="hl-comment">!-- Executes flows: the central entry point into the Spring Web Flow system --</span>&gt;
	&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> /&gt;

	&lt;<span class="hl-comment">!-- The registry of executable flow definitions --</span>&gt;
	&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"facesFlowBuilderServices"</span>&gt;
		&lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/main/main.xml"</span> /&gt;
		&lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/flows/booking/booking.xml"</span> /&gt;
	&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;

	&lt;<span class="hl-comment">!-- Configures the Spring Web Flow JSF integration --</span>&gt;
	&lt;<span class="hl-tag">faces:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"facesFlowBuilderServices"</span> /&gt;

&lt;<span class="hl-tag">/beans</span>&gt;
        </pre><p>
        	The <code class="code">faces:flow-builder-services</code> tag also several other defaults appropriate for a JSF environment.
        	Specifically, the Unified EL is configured as the default Expression Language.
        </p><p>
            See the swf-booking-faces reference application in the distribution for a complete working example.
       	</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-config"></a>12.5.&nbsp;Configuring faces-config.xml</h2></div></div></div><p>
            The only configuration needed in
            <code class="code">faces-config.xml</code>
            is specific to the use of Facelets. If you are using JSP and not using the Spring Faces components, you do
            not need to add anything specific to Spring Faces to your
            <code class="code">faces-config.xml</code>
        </p><pre class="programlisting">
&lt;<span class="hl-tag">faces-config</span>&gt;
    &lt;<span class="hl-tag">application</span>&gt;
        &lt;<span class="hl-comment">!-- Enables Facelets --</span>&gt;
        &lt;<span class="hl-tag">view-handler</span>&gt;com.sun.facelets.FaceletViewHandler&lt;<span class="hl-tag">/view-handler</span>&gt;  
    &lt;<span class="hl-tag">/application</span>&gt;
&lt;<span class="hl-tag">/faces-config</span>&gt;
        </pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-managed-beans"></a>12.6.&nbsp;Replacing the JSF Managed Bean Facility</h2></div></div></div><p>
            Spring Faces allows you to completely replace the JSF managed bean facility with a combination of
            flow-managed variables and Spring managed beans. It gives you a good deal more control over the lifecycle of
            your managed objects with well-defined hooks for initialization and execution of your domain model.
            Additionally, since you are presumably already using Spring for your business layer, it reduces the
            conceptual overhead of having to maintain two different managed bean models.
        </p><p>
            In doing pure JSF development, you will quickly find that request scope is not long-lived enough for storing
            conversational model objects that drive complex event-driven views. The only available option is to begin
            putting things into session scope, with the extra burden of needing to clean the objects up before
            progressing to another view or functional area of the application. What is really needed is a managed scope
            that is somewhere between request and session scope. Fortunately web flow provides such extended facilities.
        </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-flow-variables"></a>12.6.1.&nbsp;Using Flow Variables</h3></div></div></div><p>
                The easiest and most natural way to declare and manage the model is through the use of
                <a class="link" href="#flow-variables" title="2.8.&nbsp;Variables">flow variables</a>
                . You can declare these variables at the beginning of the flow:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span>/&gt;
            </pre><p>and then reference this variable in one of the flow's JSF view templates through EL:</p><pre class="programlisting">
&lt;<span class="hl-tag">h:inputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchString"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{searchCriteria.searchString}"</span>/&gt;
            </pre><p>
                Note that you do not need to prefix the variable with its scope when referencing it from the template
                (though you can do so if you need to be more specific). As with standard JSF beans, all available scopes
                will be searched for a matching variable, so you could change the scope of the variable in your flow
                definition without having to modify the EL expressions that reference it.
            </p><p>
                You can also define view instance variables that are scoped to the current view and get cleaned up
                automatically upon transitioning to another view. This is quite useful with JSF as views are often
                constructed to handle multiple in-page events across many requests before transitioning to another view.
            </p><p>
                To define a view instance variable, you can use the
                <code class="code">var</code>
                element inside a
                <code class="code">view-state</code>
                definition:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterSearchCriteria"</span>&gt; 
    &lt;<span class="hl-tag">var</span> <span class="hl-attribute">name</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span>/&gt; 
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-spring-beans"></a>12.6.2.&nbsp;Using Scoped Spring Beans</h3></div></div></div><p>
                Though defining autowired flow instance variables provides nice modularization and readability,
                occasions may arise where you want to utilize the other capabilities of the Spring container such as
                AOP. In these cases, you can define a bean in your Spring ApplicationContext and give it a specific web
                flow scope:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchCriteria"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"com.mycompany.myapp.hotels.search.SearchCriteria"</span> <span class="hl-attribute">scope</span>=<span class="hl-value">"flow"</span>/&gt;
            </pre><p>
                The major difference with this approach is that the bean will not be fully initialized until it is first
                accessed via an EL expression. This sort of lazy instantiation via EL is quite similar to how JSF
                managed beans are typically allocated.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="faces-manipulating-model"></a>12.6.3.&nbsp;Manipulating The Model</h3></div></div></div><p>
                The need to initialize the model before view rendering (such as by loading persistent entities from a
                database) is quite common, but JSF by itself does not provide any convenient hooks for such
                initialization. The flow definition language provides a natural facility for this through its
                <a class="link" href="#flow-actions" title="2.6.&nbsp;Actions">Actions</a>
                . Spring Faces provides some extra conveniences for converting the outcome of an action into a
                JSF-specific data structure. For example:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">on-render</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findBookings(currentUser.name)"</span> 
              <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.bookings"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
&lt;<span class="hl-tag">/on-render</span>&gt;
            </pre><p>
                This will take the result of the
                <code class="code">bookingService.findBookings</code>
                method an wrap it in a custom JSF DataModel so that the list can be used in a standard JSF DataTable
                component:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">h:dataTable</span> <span class="hl-attribute">id</span>=<span class="hl-value">"bookings"</span> <span class="hl-attribute">styleClass</span>=<span class="hl-value">"summary"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{bookings}"</span> <span class="hl-attribute">var</span>=<span class="hl-value">"booking"</span> 
             <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{bookings.rowCount &gt; 0}"</span>&gt;
    &lt;<span class="hl-tag">h:column</span>&gt;
        &lt;<span class="hl-tag">f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span>&gt;Name&lt;<span class="hl-tag">/f:facet</span>&gt;
        #{booking.hotel.name}
    &lt;<span class="hl-tag">/h:column</span>&gt;                   
    &lt;<span class="hl-tag">h:column</span>&gt;
    &lt;<span class="hl-tag">f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span>&gt;Confirmation number&lt;<span class="hl-tag">/f:facet</span>&gt;
        #{booking.id}
        &lt;<span class="hl-tag">/h:column</span>&gt;
    &lt;<span class="hl-tag">h:column</span>&gt;
        &lt;<span class="hl-tag">f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span>&gt;Action&lt;<span class="hl-tag">/f:facet</span>&gt;
        &lt;<span class="hl-tag">h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"cancel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Cancel"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"cancelBooking"</span> /&gt;
    &lt;<span class="hl-tag">/h:column</span>&gt;
&lt;<span class="hl-tag">/h:dataTable</span>&gt;
            </pre><p>
                The custom DataModel provides some extra conveniences such as being serializable for storage beyond
                request scope and access to the currently selected row in EL expressions. For example, on postback from
                a view where the action event was fired by a component within a DataTable, you can take action on the
                selected row's model instance:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"cancelBooking"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.cancelBooking(bookings.selectedRow)"</span> /&gt;            
&lt;<span class="hl-tag">/transition</span>&gt;
            </pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-event-handling"></a>12.7.&nbsp;Handling JSF Events With Spring Web Flow</h2></div></div></div><p>
            Spring Web Flow allows you to handle JSF action events in a decoupled way, requiring no direct dependencies
            in your Java code on JSF API's. In fact, these events can often be handled completely in the flow definiton
            language without requiring any custom Java action code at all. This allows for a more agile development
            process since the artifacts being manipulated in wiring up events (JSF view templates and SWF flow
            definitions) are instantly refreshable without requiring a build and re-deploy of the whole application.
        </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-in-page-events"></a>12.7.1.&nbsp;Handling JSF In-page Action Events</h3></div></div></div><p>
                A simple but common case in JSF is the need to signal an event that causes manipulation of the model in
                some way and then redisplays the same view to reflect the changed state of the model. The flow
                definition language has special support for this in the
                <code class="code">transition</code>
                element.
            </p><p>
                A good example of this is a table of paged list results. Suppose you want to be able to load and display
                only a portion of a large result list, and allow the user to page through the results. The initial
                <code class="code">view-state</code>
                definition to load and display the list would be:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span>&gt;
    &lt;<span class="hl-tag">on-render</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> 
                  <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
    &lt;<span class="hl-tag">/on-render</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre><p>
                You construct a JSF DataTable that displays the current
                <code class="code">hotels</code>
                list, and then place a "More Results" link below the table:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"nextPageLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"More Results"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"next"</span>/&gt;
            </pre><p>
                This commandLink signals a "next" event from its action attribute. You can then handle the event by
                adding to the
                <code class="code">view-state</code>
                definition:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span>&gt;
    &lt;<span class="hl-tag">on-render</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> 
            <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
    &lt;<span class="hl-tag">/on-render</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre><p>
                Here you handle the "next" event by incrementing the page count on the searchCriteria instance. The
                <code class="code">on-render</code>
                action is then called again with the updated criteria, which causes the next page of results to be
                loaded into the DataModel. The same view is re-rendered since there was no
                <code class="code">to</code>
                attribute on the
                <code class="code">transition</code>
                element, and the changes in the model are reflected in the view.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-action-events"></a>12.7.2.&nbsp;Handling JSF Action Events</h3></div></div></div><p>
                The next logical level beyond in-page events are events that require navigation to another view, with
                some manipulation of the model along the way. Achieving this with pure JSF would require adding a
                navigation rule to faces-config.xml and likely some intermediary Java code in a JSF managed bean (both
                tasks requiring a re-deploy). With the flow defintion language, you can handle such a case concisely in
                one place in a quite similar way to how in-page events are handled.
            </p><p>
                Continuing on with our use case of manipulating a paged list of results, suppose we want each row in the
                displayed DataTable to contain a link to a detail page for that row instance. You can add a column to
                the table containing the following
                <code class="code">commandLink</code>
                component:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">h:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"viewHotelLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"View Hotel"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"select"</span>/&gt;
            </pre><p>
                This raises the "select" event which you can then handle by adding another
                <code class="code">transition</code>
                element to the existing
                <code class="code">view-state</code>
                :
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"reviewHotels"</span>&gt;
    &lt;<span class="hl-tag">on-render</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"bookingService.findHotels(searchCriteria)"</span> 
            <span class="hl-attribute">result</span>=<span class="hl-value">"viewScope.hotels"</span> <span class="hl-attribute">result-type</span>=<span class="hl-value">"dataModel"</span> /&gt;
    &lt;<span class="hl-tag">/on-render</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"select"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotel"</span>&gt;
            &lt;<span class="hl-tag">set</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowScope.hotel"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"hotels.selectedRow"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre><p>
                Here the "select" event is handled by pushing the currently selected hotel instance from the DataTable
                into flow scope, so that it may be referenced by the "reviewHotel"
                <code class="code">view-state</code>
                .
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-model-validation"></a>12.7.3.&nbsp;Performing Model Validation</h3></div></div></div><p>
                JSF provides useful facilities for validating input at field-level before changes are applied to the
                model, but when you need to then perform more complex validation at the model-level after the updates
                have been applied, you are generally left with having to add more custom code to your JSF action methods
                in the managed bean. Validation of this sort is something that is generally a responsibility of the
                domain model itself, but it is difficult to get any error messages propagated back to the view without
                introducing an undesirable dependency on the JSF API in your domain layer.
            </p><p>
                With Spring Faces, you can utilize the generic and low-level
                <code class="code">MessageContext</code>
                in your business code and any messages added there will then be available to the
                <code class="code">FacesContext</code>
                at render time.
            </p><p>
                For example, suppose you have a view where the user enters the necessary details to complete a hotel
                booking, and you need to ensure the Check In and Check Out dates adhere to a given set of business
                rules. You can invoke such model-level validation from a
                <code class="code">transition</code>
                element:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"enterBookingDetails"</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewBooking"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"booking.validateEnterBookingDetails(messageContext)"</span> /&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre><p>
                Here the "proceed" event is handled by invoking a model-level validation method on the booking instance,
                passing the generic
                <code class="code">MessageContext</code>
                instance so that messages may be recorded. The messages can then be displayed along with any other JSF
                messages with the
                <code class="code">h:messages</code>
                component,
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-ajax-events"></a>12.7.4.&nbsp;Handling Ajax Events</h3></div></div></div><p>
                Spring Faces provides some special
                <code class="code">UICommand</code>
                components that go beyond the standard JSF components by adding the ability to do Ajax-based partial
                view updates. These components degrade gracefully so that the flow will still be fully functional by
                falling back to full page refreshes if a user with a less capable browser views the page.
                </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/note.gif"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">
                    Though the core JSF support in Spring Faces is JSF 1.1-compatible, the Spring Faces 
                    Ajax components require JSF 1.2.
                </td></tr></table></div><p>
            </p><p>
                Revisiting the earlier example with the paged table, you can change the "More Results" link to use an
                Ajax request by replacing the standard
                <code class="code">commandButton</code>
                with the Spring Faces version (note that the Spring Faces command components use Ajax by default, but
                they can alternately be forced to use a normal form submit by setting ajaxEnabled="false" on the
                component):
            </p><pre class="programlisting">            
&lt;<span class="hl-tag">sf:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"nextPageLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"More Results"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"next"</span> /&gt;
            </pre><p>
                This event is handled just as in the non-Ajax case with the
                <code class="code">transition</code>
                element, but now you will add a special
                <code class="code">render</code>
                action that specifies which portions of the component tree need to be re-rendered:
            </p><pre class="programlisting">
&lt;view-state id="reviewHotels"&gt;
    &lt;on-render&gt;
        &lt;evaluate expression="bookingService.findHotels(searchCriteria)" 
                  result="viewScope.hotels" result-type="dataModel" /&gt;
    &lt;/on-render&gt;
    &lt;transition on="next"&gt;
        &lt;evaluate expression="searchCriteria.nextPage()" /&gt;
        &lt;render fragments="hotels:searchResultsFragment" /&gt;
    &lt;/transition&gt;
&lt;/view-state&gt;
            </pre><p>
                The
                <code class="code">fragments="hotels:searchResultsFragment"</code>
                is an instruction that will be interpreted at render time, such that only the component with the JSF
                clientId "hotels:searchResultsFragment" will be rendered and returned to the client. This fragment will
                then be automatically replaced in the page. The
                <code class="code">fragments</code>
                attribute can be a comma-delimited list of ids, with each id representing the root node of a subtree
                (meaning the root node and all of its children) to be rendered. If the "next" event is fired in a
                non-Ajax request (i.e., if JavaScript is disabled on the client), the
                <code class="code">render</code>
                action will be ignored and the full page will be rendered as normal.
            </p><p>
                In addition to the Spring Faces
                <code class="code">commandLink</code>
                component, there is a corresponding
                <code class="code">commandButton</code>
                component with the same functionality. There is also a special
                <code class="code">ajaxEvent</code>
                component that will raise a JSF action even in response to any client-side DOM event. See the Spring
                Faces tag library docs for full details.
            </p><p>
                An additional built-in feature when using the Spring Faces Ajax components is the ability to have the
                response rendered inside a rich modal popup widget by setting
                <code class="code">popup="true"</code>
                on a
                <code class="code">view-state</code>
                .
            </p><pre class="programlisting">
&lt;<span class="hl-tag">view-state</span> <span class="hl-attribute">id</span>=<span class="hl-value">"changeSearchCriteria"</span> <span class="hl-attribute">view</span>=<span class="hl-value">"enterSearchCriteria.xhtml"</span> <span class="hl-attribute">popup</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">on-entry</span>&gt;
        &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotelSearchFragment"</span> /&gt;
    &lt;<span class="hl-tag">/on-entry</span>&gt;
    &lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"search"</span> <span class="hl-attribute">to</span>=<span class="hl-value">"reviewHotels"</span>&gt;
        &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.resetPage()"</span>/&gt;
    &lt;<span class="hl-tag">/transition</span>&gt;
&lt;<span class="hl-tag">/view-state</span>&gt;
            </pre><p>
                If the "changeSearchCriteria"
                <code class="code">view-state</code>
                is reached as the result of an Ajax-request, the result will be rendered into a rich popup. If
                JavaScript is unavailable, the request will be processed with a full browser refresh, and the
                "changeSearchCriteria" view will be rendered as normal.
            </p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-ui-controls"></a>12.8.&nbsp;Enhancing The User Experience With Rich Web Forms</h2></div></div></div><p>
            JSF and Web Flow combine to provide and extensive server-side validation model for your web application, but
            excessive roundtrips to the server to execute this validation and return error messages can be a tedious
            experience for your users. Spring Faces provides a number of client-side rich validation controls that can
            enhance the user experience by applying simple validations that give immediate feedback. Some simple
            examples are illustrated below. See the Spring Faces taglib docs for a complete tag reference.
        </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-text-validation"></a>12.8.1.&nbsp;Validating a Text Field</h3></div></div></div><p>
                Simple client-side text validation can be applied with the
                <code class="code">clientTextValidator</code>
                component:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">sf:clientTextValidator</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span>&gt;
    &lt;<span class="hl-tag">h:inputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"creditCardName"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{booking.creditCardName}"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/sf:clientTextValidator</span>&gt;
            </pre><p>
                This will apply client-side required validation to the child
                <code class="code">inputText</code>
                component, giving the user a clear indicator if the field is left blank.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-number-validation"></a>12.8.2.&nbsp;Validating a Numeric Field</h3></div></div></div><p>
                Simple client-side numeric validation can be applied with the
                <code class="code">clientNumberValidator</code>
                component:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">sf:clientTextValidator</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> <span class="hl-attribute">regExp</span>=<span class="hl-value">"[0-9]{16}"</span> 
                        <span class="hl-attribute">invalidMessage</span>=<span class="hl-value">"A 16-digit credit card number is required."</span>&gt;
    &lt;<span class="hl-tag">h:inputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"creditCard"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{booking.creditCard}"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span>/&gt;
&lt;<span class="hl-tag">/sf:clientTextValidator</span>&gt;
            </pre><p>
                This will apply client-side validation to the child
                <code class="code">inputText</code>
                component, giving the user a clear indicator if the field is left blank, is not numeric, or does not
                match the given regular expression.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-date-validation"></a>12.8.3.&nbsp;Validating a Date Field</h3></div></div></div><p>
                Simple client-side date validation with a rich calendar popup can be applied with the
                <code class="code">clientDateValidator</code>
                component:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">sf:clientDateValidator</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span> &gt;
    &lt;<span class="hl-tag">h:inputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"checkinDate"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{booking.checkinDate}"</span> <span class="hl-attribute">required</span>=<span class="hl-value">"true"</span>&gt;
	   	&lt;<span class="hl-tag">f:convertDateTime</span> <span class="hl-attribute">pattern</span>=<span class="hl-value">"yyyy-MM-dd"</span> <span class="hl-attribute">timeZone</span>=<span class="hl-value">"EST"</span>/&gt;
	&lt;<span class="hl-tag">/h:inputText</span>&gt;
&lt;<span class="hl-tag">/sf:clientDateValidator</span>&gt;
            </pre><p>
                This will apply client-side validation to the child
                <code class="code">inputText</code>
                component, giving the user a clear indicator if the field is left blank or is not a valid date.
            </p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-validate-all"></a>12.8.4.&nbsp;Preventing an Invalid Form Submission</h3></div></div></div><p>
                The
                <code class="code">validateAllOnClick</code>
                component can be used to intercept the "onclick" event of a child component and suppress the event if
                all client-side validations do not pass.
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">sf:validateAllOnClick</span>&gt;
    &lt;<span class="hl-tag">sf:commandButton</span> <span class="hl-attribute">id</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"proceed"</span> <span class="hl-attribute">processIds</span>=<span class="hl-value">"*"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"Proceed"</span>/&gt;&amp;#160;
&lt;<span class="hl-tag">/sf:validateAllOnClick</span>&gt;
            </pre><p>
                This will prevent the form from being submitted when the user clicks the "proceed" button if the form is
                invalid. When the validations are executed, the user is given clear and immediate indicators of the
                problems that need to be corrected.
            </p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-faces-component-libraries"></a>12.9.&nbsp;Third-Party Component Library Integration</h2></div></div></div><p>
            Spring Faces strives to be compatible with any third-party JSF component library. By honoring all of the
            standard semantics of the JSF specification within the SWF-driven JSF lifecycle, third-party libraries in
            general should "just work". The main thing to remember is that configuration in web.xml will change slightly
            since Spring Faces requests are not routed through the standard FacesServlet. Typically, anything that is
            traditionally mapped to the FacesServlet should be mapped to the Spring DispatcherServlet instead. (You can
            also map to both if for example you are migrating a legacy JSF application page-by-page.) In some cases, a
            deeper level of integration can be achieved by configuring special flow services that are "aware" of a
            particular component library, and these will be noted in the examples to follow.
        </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-with-richfaces"></a>12.9.1.&nbsp;Rich Faces Integration</h3></div></div></div><p>
                To use the Rich Faces component library with Spring Faces, the following filter configuration is needed
                in web.xml (in addition to the typical Spring Faces configuration):
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">filter</span>&gt; 
    &lt;<span class="hl-tag">display-name</span>&gt;RichFaces Filter&lt;<span class="hl-tag">/display-name</span>&gt; 
    &lt;<span class="hl-tag">filter-name</span>&gt;richfaces&lt;<span class="hl-tag">/filter-name</span>&gt; 
    &lt;<span class="hl-tag">filter-class</span>&gt;org.ajax4jsf.Filter&lt;<span class="hl-tag">/filter-class</span>&gt; 
&lt;<span class="hl-tag">/filter</span>&gt; 

&lt;<span class="hl-tag">filter-mapping</span>&gt; 
    &lt;<span class="hl-tag">filter-name</span>&gt;richfaces&lt;<span class="hl-tag">/filter-name</span>&gt; 
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring Web MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">dispatcher</span>&gt;REQUEST&lt;<span class="hl-tag">/dispatcher</span>&gt;
    &lt;<span class="hl-tag">dispatcher</span>&gt;FORWARD&lt;<span class="hl-tag">/dispatcher</span>&gt;
    &lt;<span class="hl-tag">dispatcher</span>&gt;INCLUDE&lt;<span class="hl-tag">/dispatcher</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;
            </pre><p>
                For deeper integration (including the ability to have a view with combined use of the Spring Faces Ajax
                components and Rich Faces Ajax components), configure the RichFacesAjaxHandler on your FlowController:
            </p><pre class="programlisting"> 
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowController"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowController"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"ajaxHandler"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.faces.richfaces.RichFacesAjaxHandler"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
            </pre><p>
                RichFaces Ajax components can be used in conjunction with the
                <code class="code">render</code>
                tag to render partial fragments on an Ajax request. Instead of embedding the ids of the components to be
                re-rendered directly in the view template (as you traditionally do with Rich Faces), you can bind the
                <code class="code">reRender</code>
                attribute of a RichFaces Ajax component to a special
                <code class="code">flowRenderFragments</code>
                EL variable. For example, in your view template you can have a fragment that you would potentially like
                to re-render in response to a particular event:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">h:form</span> <span class="hl-attribute">id</span>=<span class="hl-value">"hotels"</span>&gt;
    &lt;<span class="hl-tag">a4j:outputPanel</span> <span class="hl-attribute">id</span>=<span class="hl-value">"searchResultsFragment"</span>&gt;
        &lt;<span class="hl-tag">h:outputText</span> <span class="hl-attribute">id</span>=<span class="hl-value">"noHotelsText"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"No Hotels Found"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{hotels.rowCount == 0}"</span>/&gt;
        &lt;<span class="hl-tag">h:dataTable</span> <span class="hl-attribute">id</span>=<span class="hl-value">"hotels"</span> <span class="hl-attribute">styleClass</span>=<span class="hl-value">"summary"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"#{hotels}"</span> <span class="hl-attribute">var</span>=<span class="hl-value">"hotel"</span> <span class="hl-attribute">rendered</span>=<span class="hl-value">"#{hotels.rowCount &gt; 0}"</span>&gt;
            &lt;<span class="hl-tag">h:column</span>&gt;
                &lt;<span class="hl-tag">f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span>&gt;Name&lt;<span class="hl-tag">/f:facet</span>&gt;
                #{hotel.name}
            &lt;<span class="hl-tag">/h:column</span>&gt;
            &lt;<span class="hl-tag">h:column</span>&gt;
                &lt;<span class="hl-tag">f:facet</span> <span class="hl-attribute">name</span>=<span class="hl-value">"header"</span>&gt;Address&lt;<span class="hl-tag">/f:facet</span>&gt;
                #{hotel.address}
            &lt;<span class="hl-tag">/h:column</span>&gt;
        &lt;<span class="hl-tag">/h:dataTable</span>&gt;
    &lt;<span class="hl-tag">/a4j:outputPanel</span>&gt;
&lt;<span class="hl-tag">/h:form</span>&gt;
            </pre><p>
                then a RichFaces Ajax
                <code class="code">commandLink</code>
                to fire the event:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">a4j:commandLink</span> <span class="hl-attribute">id</span>=<span class="hl-value">"nextPageLink"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"More Results"</span> <span class="hl-attribute">action</span>=<span class="hl-value">"next"</span> <span class="hl-attribute">reRender</span>=<span class="hl-value">"#{flowRenderFragments}"</span> /&gt;
            </pre><p>
                and then in your flow definition a
                <code class="code">transition</code>
                to handle the event:
            </p><pre class="programlisting">
&lt;<span class="hl-tag">transition</span> <span class="hl-attribute">on</span>=<span class="hl-value">"next"</span>&gt;
    &lt;<span class="hl-tag">evaluate</span> <span class="hl-attribute">expression</span>=<span class="hl-value">"searchCriteria.nextPage()"</span> /&gt;
    &lt;<span class="hl-tag">render</span> <span class="hl-attribute">fragments</span>=<span class="hl-value">"hotels:searchResultsFragment"</span> /&gt;
&lt;<span class="hl-tag">/transition</span>&gt;
            </pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="spring-faces-with-trinidad"></a>12.9.2.&nbsp;Apache MyFaces Trinidad Integration</h3></div></div></div><p>
                The Apache MyFaces Trinidad library has been tested with the Spring Faces integration and proven to fit
                in nicely. Deeper integration to allow the Trinidad components and Spring Faces components to play
                well together has not yet been attempted, but Trinidad provides a pretty thorough solution on its own
                when used in conjunction with the Spring Faces integration layer.
            </p><p>
                Typical Trinidad + Spring Faces configuration is as follows in web.xml (in addition to the typical
                Spring Faces configuration):
            </p><pre class="programlisting">
&lt;<span class="hl-tag">context-param</span>&gt;
    &lt;<span class="hl-tag">param-name</span>&gt;javax.faces.STATE_SAVING_METHOD&lt;<span class="hl-tag">/param-name</span>&gt;
    &lt;<span class="hl-tag">param-value</span>&gt;server&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;

&lt;<span class="hl-tag">context-param</span>&gt;
    &lt;<span class="hl-tag">param-name</span>&gt;
        org.apache.myfaces.trinidad.CHANGE_PERSISTENCE
    &lt;<span class="hl-tag">/param-name</span>&gt;
    &lt;<span class="hl-tag">param-value</span>&gt;session&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;

&lt;<span class="hl-tag">context-param</span>&gt;
    &lt;<span class="hl-tag">param-name</span>&gt;
        org.apache.myfaces.trinidad.ENABLE_QUIRKS_MODE
    &lt;<span class="hl-tag">/param-name</span>&gt;
    &lt;<span class="hl-tag">param-value</span>&gt;false&lt;<span class="hl-tag">/param-value</span>&gt;
&lt;<span class="hl-tag">/context-param</span>&gt;

&lt;<span class="hl-tag">filter</span>&gt;
    &lt;<span class="hl-tag">filter-name</span>&gt;Trinidad Filter&lt;<span class="hl-tag">/filter-name</span>&gt;
    &lt;<span class="hl-tag">filter-class</span>&gt;
        org.apache.myfaces.trinidad.webapp.TrinidadFilter
    &lt;<span class="hl-tag">/filter-class</span>&gt;
&lt;<span class="hl-tag">/filter</span>&gt;

&lt;<span class="hl-tag">filter-mapping</span>&gt;
    &lt;<span class="hl-tag">filter-name</span>&gt;Trinidad Filter&lt;<span class="hl-tag">/filter-name</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Spring MVC Dispatcher Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
&lt;<span class="hl-tag">/filter-mapping</span>&gt;

&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;Trinidad Resource Servlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;
        org.apache.myfaces.trinidad.webapp.ResourceServlet
    &lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;resources&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/adf/*&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;

            </pre></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="portlet"></a>13.&nbsp;Portlet Integration</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-introduction"></a>13.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows how to use Web Flow in a Portlet environment.
			Web Flow has full support for JSR-168 portlets.
			The <code class="code">booking-portlet-mvc</code> sample application is a good reference for using Web Flow within a portlet.
			This application is a simplified travel site that allows users to search for and book hotel rooms.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-config-core"></a>13.2.&nbsp;Configuring web.xml and portlet.xml</h2></div></div></div><p>
			The configuration for a portlet depends on the portlet container used.
			The sample applications, included with Web Flow, are both configured to use <a class="ulink" href="http://portals.apache.org/pluto/" target="_top">Apache Pluto</a>, the JSR-168 reference implementation.
		</p><p>
			In general, the configuration requires adding a servlet mapping in the <code class="code">web.xml</code> file to dispatch request to the portlet container.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;swf-booking-mvc&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.apache.pluto.core.PortletServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
    &lt;<span class="hl-tag">init-param</span>&gt;
        &lt;<span class="hl-tag">param-name</span>&gt;portlet-name&lt;<span class="hl-tag">/param-name</span>&gt;
        &lt;<span class="hl-tag">param-value</span>&gt;swf-booking-mvc&lt;<span class="hl-tag">/param-value</span>&gt;
    &lt;<span class="hl-tag">/init-param</span>&gt;
    &lt;<span class="hl-tag">load-on-startup</span>&gt;1&lt;<span class="hl-tag">/load-on-startup</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;swf-booking-mvc&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/PlutoInvoker/swf-booking-mvc&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
		</pre><p>
			The <code class="code">portlet.xml</code> configuration is a standard portlet configuration.
			The <code class="code">portlet-class</code> needs to be set along with a pair of <code class="code">init-param</code>s.
			Setting the <code class="code">expiration-cache</code> to <code class="code">0</code> is recommended to force Web Flow to always render a fresh view. 
		</p><pre class="programlisting">
&lt;<span class="hl-tag">portlet</span>&gt;
    ...
    &lt;<span class="hl-tag">portlet-class</span>&gt;org.springframework.web.portlet.DispatcherPortlet&lt;<span class="hl-tag">/portlet-class</span>&gt;
    &lt;<span class="hl-tag">init-param</span>&gt;
        &lt;<span class="hl-tag">name</span>&gt;contextConfigLocation&lt;<span class="hl-tag">/name</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/web-application-config.xml&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/init-param</span>&gt;
    &lt;<span class="hl-tag">init-param</span>&gt;
        &lt;<span class="hl-tag">name</span>&gt;viewRendererUrl&lt;<span class="hl-tag">/name</span>&gt;
        &lt;<span class="hl-tag">value</span>&gt;/WEB-INF/servlet/view&lt;<span class="hl-tag">/value</span>&gt;
    &lt;<span class="hl-tag">/init-param</span>&gt;
    &lt;<span class="hl-tag">expiration-cache</span>&gt;0&lt;<span class="hl-tag">/expiration-cache</span>&gt;
    ...
&lt;<span class="hl-tag">/portlet</span>&gt;
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-config-spring"></a>13.3.&nbsp;Configuring Spring</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-config-spring-handler"></a>13.3.1.&nbsp;Flow Handlers</h3></div></div></div><p>
				The only supported mechanism for bridging a portlet request to Web Flow is a <code class="code">FlowHandler</code>.
				The <code class="code">PortletFlowController</code> used in Web Flow 1.0 is no longer supported.
			</p><p>
				The flow handler, similar to the servlet flow handler, provides hooks that can:
				</p><div class="itemizedlist"><ul type="disc"><li><p>select the flow to execute</p></li><li><p>pass input parameters to the flow on initialization</p></li><li><p>handle the flow execution outcome</p></li><li><p>handle exceptions</p></li></ul></div><p>
			</p><p>
				The <code class="code">AbstractFlowHandler</code> class is an implementation of <code class="code">FlowHandler</code> that provides default implementations for these hooks.
			</p><p>
				In a portlet environment the targeted flow id can not be inferred from the URL and must be defined explicitly in the handler.
			</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ViewFlowHandler <span class="hl-keyword">extends</span> AbstractFlowHandler {
    <span class="hl-keyword">public</span> String getFlowId() {
        <span class="hl-keyword">return</span> <span class="hl-string">"view"</span>;
    }
}
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-config-spring-mappings"></a>13.3.2.&nbsp;Handler Mappings</h3></div></div></div><p>
				Spring Portlet MVC provides a rich set of methods to map portlet requests.
				Complete documentation  is available in the <a class="ulink" href="http://static.springframework.org/spring/docs/2.5.x/reference/portlet.html#portlet-handlermapping" target="_top">Spring Reference Documentation</a>.
			</p><p>
				The <code class="code">booking-portlet-mvc</code> sample application uses a <code class="code">PortletModeHandlerMapping</code> to map portlet requests.
				The sample application only supports <code class="code">view</code> mode, but support for other portlet modes is available.
				Other modes can be added and point to the same flow as <code class="code">view</code> mode, or any other flow. 
			</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"portletModeHandlerMapping"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.portlet.handler.PortletModeHandlerMapping"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"portletModeMap"</span>&gt;
        &lt;<span class="hl-tag">map</span>&gt;
            &lt;<span class="hl-tag">entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">"view"</span>&gt;
                &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.samples.booking.ViewFlowHandler"</span> /&gt;
            &lt;<span class="hl-tag">/entry</span>&gt;
        &lt;<span class="hl-tag">/map</span>&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-config-spring-handler-adapter"></a>13.3.3.&nbsp;Flow Handler Adapter</h3></div></div></div><p>
				A <code class="code">FlowHandlerAdapter</code> converts the handler mappings to the flow handlers.
				The flow executor is required as a constructor argument.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowHandlerAdapter"</span> 
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.portlet.FlowHandlerAdapter"</span>&gt;
    &lt;<span class="hl-tag">constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-views"></a>13.4.&nbsp;Portlet Views</h2></div></div></div><p>
			In order to facilitate view rendering, a <code class="code">ViewRendererServlet</code> must be added to the <code class="code">web.xml</code> file.
			This servlet is not invoked directly, but it used by Web Flow to render views in a portlet environment.
		</p><pre class="programlisting">
&lt;<span class="hl-tag">servlet</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;ViewRendererServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">servlet-class</span>&gt;org.springframework.web.servlet.ViewRendererServlet&lt;<span class="hl-tag">/servlet-class</span>&gt;
&lt;<span class="hl-tag">/servlet</span>&gt;

&lt;<span class="hl-tag">servlet-mapping</span>&gt;
    &lt;<span class="hl-tag">servlet-name</span>&gt;ViewRendererServlet&lt;<span class="hl-tag">/servlet-name</span>&gt;
    &lt;<span class="hl-tag">url-pattern</span>&gt;/WEB-INF/servlet/view&lt;<span class="hl-tag">/url-pattern</span>&gt;
&lt;<span class="hl-tag">/servlet-mapping</span>&gt;
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-modes"></a>13.5.&nbsp;Portlet Modes and Window States</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-modes-state"></a>13.5.1.&nbsp;Window State</h3></div></div></div><p>
				The Portlet API defined three window states: normal, minimized and maximized.
				The portlet implementation must decide what to render for each of these window states.
				Web Flow exposes the string value of the window state under <code class="code">portletWindowState</code> via the request map on the external context.
			</p><pre class="programlisting">
requestContext.getExternalContext().getRequestMap().get(<span class="hl-string">"portletWindowState"</span>);
			</pre><pre class="programlisting">
externalContext.requestMap.portletWindowState
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-modes-mode"></a>13.5.2.&nbsp;Portlet Mode</h3></div></div></div><p>
				The Portlet API defined three portlet modes: view, edit and help.
				The portlet implementation must decide what to render for each of these modes.
				Web Flow exposes the string value of the portlet mode under <code class="code">portletMode</code> via the request map on the external context.
			</p><pre class="programlisting">
requestContext.getExternalContext().getRequestMap().get(<span class="hl-string">"portletMode"</span>);
			</pre><pre class="programlisting">
externalContext.requestMap.portletMode
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="portlet-issues"></a>13.6.&nbsp;Issues in a Portlet Environment</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-issues-redirects"></a>13.6.1.&nbsp;Redirects</h3></div></div></div><p>
				The Portlet API only allows redirects to be requested from an action request.
				Because views are rendered on the render request, views and <code class="code">view-state</code>s cannot trigger a redirect.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-issues-modes"></a>13.6.2.&nbsp;Switching Portlet Modes</h3></div></div></div><p>
				The portlet container passes the execution key from the previous flow when switching to a new mode.
				Even if the mode is mapped to a different <code class="code">FlowHandler</code> the flow execution will resume the previous execution.
				You may switch the mode programatically in your FlowHandler after ending a flow in an ActionRequest.
			</p><p>
				One way to start a new flow is to create a URL targeting the mode without the execution key.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="portlet-issues-jsf"></a>13.6.3.&nbsp;Portlets and JSF</h3></div></div></div><p>
				Web Flow supports JSF as the view technology for a portlet.
				However, a jsf-portlet bridge (JSR-301) must be provided.
				At the time of this writing, no feature complete jsf-portlet bridge exists.
				Some of the existing bridge implementations may appear to work, however, side effect may occur.
			</p><p>
				JSF portlets are considered experimental at this time.
			</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testing"></a>14.&nbsp;Testing flows</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-introduction"></a>14.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows you how to test flows.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extending-abstractflowexecutiontest"></a>14.2.&nbsp;Extending AbstractXmlFlowExecutionTests</h2></div></div></div><p>
			To test the execution of a XML-based flow definition, extend <code class="code">AbstractXmlFlowExecutionTests</code>:
		</p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingFlowExecutionTests <span class="hl-keyword">extends</span> AbstractXmlFlowExecutionTests {

}
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="override-getResource"></a>14.3.&nbsp;Specifying the path to the flow to test</h2></div></div></div><p>
			At a minimum, you must override <code class="code">getResource(FlowDefinitionResourceFactory)</code> to return the path to the flow you wish to test:
		</p><pre class="programlisting">
@Override
<span class="hl-keyword">protected</span> FlowDefinitionResource getResource(FlowDefinitionResourceFactory resourceFactory) {
    <span class="hl-keyword">return</span> resourceFactory.createFileResource(<span class="hl-string">"src/main/webapp/WEB-INF/flows/booking/booking.xml"</span>);
}
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="override-configureFlowBuilderContext"></a>14.4.&nbsp;Registering flow dependencies</h2></div></div></div><p>
			If your flow has dependencies on externally managed services,
			also override <code class="code">configureFlowBuilderContext(MockFlowBuilderContext)</code> to register stubs or mocks of those services:
		</p><pre class="programlisting">
@Override
<span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> configureFlowBuilderContext(MockFlowBuilderContext builderContext) {
    builderContext.registerBean(<span class="hl-string">"bookingService"</span>, <span class="hl-keyword">new</span> StubBookingService());
}
        </pre><p>
        	If your flow extends from another flow, or has states that extend other states,
        	also override <code class="code">getModelResources(FlowDefinitionResourceFactory)</code> to return the path to the parent flows.
        </p><pre class="programlisting">
@Override
<span class="hl-keyword">protected</span> FlowDefinitionResource[] getModelResources(FlowDefinitionResourceFactory resourceFactory) {
   <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> FlowDefinitionResource[] {
       resourceFactory.createFileResource(<span class="hl-string">"src/main/webapp/WEB-INF/flows/common/common.xml"</span>)
   };
}
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-flowstartup"></a>14.5.&nbsp;Testing flow startup</h2></div></div></div><p>
        	Have your first test exercise the startup of your flow:
        </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testStartBookingFlow() {

    Booking booking = createTestBooking();

    MutableAttributeMap input = <span class="hl-keyword">new</span> LocalAttributeMap();
    input.put(<span class="hl-string">"hotelId"</span>, <span class="hl-string">"1"</span>);
    MockExternalContext context = <span class="hl-keyword">new</span> MockExternalContext();
    context.setCurrentUser(<span class="hl-string">"keith"</span>);
    startFlow(input, context);

    assertCurrentStateEquals(<span class="hl-string">"enterBookingDetails"</span>);
    assertTrue(getRequiredFlowAttribute(<span class="hl-string">"booking"</span>) <span class="hl-keyword">instanceof</span> Booking);
}
        </pre><p>
        	Assertions generally verify the flow is in the correct state you expect.
        </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-flowevents"></a>14.6.&nbsp;Testing flow event handling</h2></div></div></div><p>
        	Define additional tests to exercise flow event handling behavior.
        	You goal should be to exercise all paths through the flow.
        	You can use the convenient <code class="code">setCurrentState(String)</code> method to jump to the flow state where you wish to begin your test.
        </p><pre class="programlisting">
public void testEnterBookingDetails_Proceed() {

    setCurrentState("enterBookingDetails");
    
    getFlowScope().put("booking", createTestBooking());

    MockExternalContext context = new MockExternalContext();
    context.setEventId("proceed");
    resumeFlow(context);

    assertCurrentStateEquals("reviewBooking");
}
		</pre></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testing-mockingsubflows"></a>14.7.&nbsp;Mocking a subflow</h2></div></div></div><p>
        	To test calling a subflow, register a mock implementation of the subflow that asserts input was passed in correctly and 
        	returns the correct outcome for your test scenario.
        </p><pre class="programlisting">
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testBookHotel() {
    
    setCurrentState(<span class="hl-string">"reviewHotel"</span>);

    Hotel hotel = <span class="hl-keyword">new</span> Hotel();
    hotel.setId(1L);
    hotel.setName(<span class="hl-string">"Jameson Inn"</span>);
    getFlowScope().put(<span class="hl-string">"hotel"</span>, hotel);

    getFlowDefinitionRegistry().registerFlowDefinition(createMockBookingSubflow());

    MockExternalContext context = <span class="hl-keyword">new</span> MockExternalContext();
    context.setEventId(<span class="hl-string">"book"</span>);
    resumeFlow(context);

    <span class="hl-comment">// verify flow ends on 'bookingConfirmed'</span>
    assertFlowExecutionEnded();
    assertFlowExecutionOutcomeEquals(<span class="hl-string">"finish"</span>);
}

<span class="hl-keyword">public</span> Flow createMockBookingSubflow() {
    Flow mockBookingFlow = <span class="hl-keyword">new</span> Flow(<span class="hl-string">"booking"</span>);
    mockBookingFlow.setInputMapper(<span class="hl-keyword">new</span> Mapper() {
        <span class="hl-keyword">public</span> MappingResults map(Object source, Object target) {
            <span class="hl-comment">// assert that 1L was passed in as input</span>
            assertEquals(1L, ((AttributeMap) source).get(<span class="hl-string">"hotelId"</span>));
            <span class="hl-keyword">return</span> null;
        }
    });
    <span class="hl-comment">// immediately return the bookingConfirmed outcome so the caller can respond</span>
    <span class="hl-keyword">new</span> EndState(mockBookingFlow, <span class="hl-string">"bookingConfirmed"</span>);
    <span class="hl-keyword">return</span> mockBookingFlow;
}
		</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="upgrade-guide"></a>15.&nbsp;Upgrading from 1.0</h2></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-guide-introduction"></a>15.1.&nbsp;Introduction</h2></div></div></div><p>
			This chapter shows you how to upgrade existing Web Flow 1 application to Web Flow 2.
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-guide-definition-language"></a>15.2.&nbsp;Flow Definition Language</h2></div></div></div><p>
			The core concepts behind the flow definition language have not changed between Web Flow 1 and 2.
			However, some of the element and attribute names have changed.
			These changes allow for the language to be both more concise and expressive.
			A complete list of <a class="link" href="#field-mappings" title="Appendix&nbsp;A.&nbsp;Flow Definition Language 1.0 to 2.0 Mappings">mapping changes</a> is available as an appendix.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-definition-language-tool"></a>15.2.1.&nbsp;Flow Definition Updater Tool</h3></div></div></div><p>
				An automated tool is available to aid in the conversion of existing 1.x flows to the new 2.x style.
				The tool will convert all the old tag names to their new equivalents, if needed.
				While the tool will make a best effort attempt at conversion, there is not a one-to-one mapping for all version 1 concepts.
				If the tool was unable to convert a portion of the flow, it will be marked with a <code class="code">WARNING</code> comment in the resulting flow.
			</p><p>
				The conversion tool requires spring-webflow.jar, spring-core.jar and an XSLT 1.0 engine.
				<a class="ulink" href="http://saxon.sourceforge.net/" target="_top">Saxon 6.5.5</a> is recommended.
			</p><p>
				The tool can be run from the command line with the following command.
				Required libraries must be available on the classpath.
				The source must be a single flow to convert.
				The resulting converted flow will be sent to standard output.
			</p><pre class="programlisting">
java org.springframework.webflow.upgrade.WebFlowUpgrader flow-to-upgrade.xml
			</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="upgrade-guide-definition-language-tool-warnings"></a>15.2.1.1.&nbsp;Flow Definition Updater Tool Warnings</h4></div></div></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="upgrade-guide-definition-language-tool-warnings-argument-parameter-type"></a>argument parameter-type no longer supported</h5></div></div></div><p>
						Bean actions have been deprecated in favor of EL based evaluate expressions.
						The EL expression is able to accept method parameters directly, so there is no longer a need for the argument tag.
						A side effect of this change is that method arguments must be of the correct type before invoking the action.
					</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="upgrade-guide-definition-language-tool-warnings-inline-flow"></a>inline-flow is no longer supported</h5></div></div></div><p>
						Inline flows are no longer supported.
						The contents of the inline flow must be moved into a new top-level flow.
						The inline flow's content has been converted for your convenience.
					</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="upgrade-guide-definition-language-tool-warnings-mapping-target-collection"></a>mapping target-collection is no longer supported</h5></div></div></div><p>
						Output mappings can no longer add an item to a collection.
						Only assignment is supported.
					</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="upgrade-guide-definition-language-tool-warnings-var-bean"></a>var bean is no longer supported</h5></div></div></div><p>
						The var bean attribute is no longer needed.
						All spring beans can be resolved via EL. 
					</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="upgrade-guide-definition-language-tool-warnings-var=scope"></a>var scope is no longer supported</h5></div></div></div><p>
						The var element will place all variable into flow scope.
						Conversation scope was previously allowed.
					</p></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-definition-language-el"></a>15.2.2.&nbsp;EL Expressions</h3></div></div></div><p>
				EL expressions are used heavily throughout the flow definition language.
				Many of the attributes that appear to be plain text are actually interpreted as EL.
				The standard EL delimiters (either ${} or #{}) are not necessary and will often cause an exception if they are included. 
			</p><p>
				EL delimiters should be removed where necessary by the updater tool.
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-guide-webflow-config"></a>15.3.&nbsp;Web Flow Configuration</h2></div></div></div><p>
			In Web Flow 1 there were two options available for configuring Web Flow, one using standard spring bean XML and the other using the <code class="code">webflow-config-1.0</code> schema.
			The schema configuration option simplifies the configuration process by keeping long internal class names hidden and enabling contextual auto-complete.
			The schema configuration option is the only way to configure Web Flow 2.
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-config-beans"></a>15.3.1.&nbsp;Web Flow Bean Configuration</h3></div></div></div><p>
				The <code class="code">FactoryBean</code> bean XML configuration method used in Web Flow 1 is no longer supported.
				The schema configuration method should be used instead.
				In particular beans defining <code class="code">FlowExecutorFactoryBean</code> and <code class="code">XmlFlowRegistryFactoryBean</code> should be updated.
				Continue reading Web Flow Schema Configuration for details.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-config-schema"></a>15.3.2.&nbsp;Web Flow Schema Configuration</h3></div></div></div><p>
				The <code class="code">webflow-config</code> configuration schema has also changed slightly from version 1 to 2.
				The simplest way to update your application is modify the version of the schema to 2.0 then fix any errors in a schema aware XML editor.
				The most common change is add 'flow-' to the beginning of the elements defined by the schema.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="hl-attribute">xmlns:webflow</span>=<span class="hl-value">"http://www.springframework.org/schema/webflow-config"</span>
       <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">"
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/webflow-config
           http://www.springframework.org/schema/webflow-config/spring-webflow-config-2.0.xsd"</span>&gt;
			</pre><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="upgrade-guide-webflow-config-schema-executor"></a>15.3.2.1.&nbsp;flow-executor</h4></div></div></div><p>
					The flow executor is the core Web Flow configuration element.
					This element replaces previous <code class="code">FlowExecutorFactoryBean</code> bean definitions.
				</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> /&gt;
				</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="upgrade-guide-webflow-config-schema-listeners"></a>15.3.2.2.&nbsp;flow-execution-listeners</h4></div></div></div><p>
					Flow execution listeners are also defined in the flow executor.
					Listeners are defined using standard bean definitions and added by reference.
				</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">flow-registry</span>=<span class="hl-value">"flowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-execution-listeners</span>&gt;
        &lt;<span class="hl-tag">webflow:listener</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"securityFlowExecutionListener"</span>/&gt;
    &lt;<span class="hl-tag">/webflow:flow-execution-listeners</span>&gt;
&lt;<span class="hl-tag">/webflow:flow-executor</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"securityFlowExecutionListener"</span>
      <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.security.SecurityFlowExecutionListener"</span> /&gt;
				</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="upgrade-guide-webflow-config-schema-registry"></a>15.3.2.3.&nbsp;flow-registry</h4></div></div></div><p>
					The <code class="code">flow-registry</code> contains a set of <code class="code">flow-location</code>s.
					Every flow definition used by Web Flow must be added to the registry.
					This element replaces previous <code class="code">XmlFlowRegistryFactoryBean</code> bean definitions.
				</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span>&gt;
    &lt;<span class="hl-tag">webflow:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"/WEB-INF/hotels/booking/booking.xml"</span> /&gt;
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;
				</pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-java-controller"></a>15.3.3.&nbsp;Flow Controller</h3></div></div></div><p>
				The package name for flow controllers has changed from <code class="code">org.springframework.webflow.executor.mvc.FlowController</code> and is now <code class="code">org.springframework.webflow.mvc.servlet.FlowController</code> for Servlet MVC requests.
				The portlet flow controller <code class="code">org.springframework.webflow.executor.mvc.PortletFlowController</code> has been replaced by a flow handler adapter available at <code class="code">org.springframework.webflow.mvc.portlet.FlowHandlerAdapter</code>.
				They will need to be updated in the bean definitions.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-java-url-handler"></a>15.3.4.&nbsp;Flow Request URL Handler</h3></div></div></div><p>
				The default URL handler has changed in Web Flow 2.
				The flow identifier is now derived from the URL rather then passed explicitly.
				In order to maintain comparability with existing views and URL structures a <code class="code">WebFlow1FlowUrlHandler</code> is available.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">"/pos.htm"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.servlet.FlowController"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowExecutor"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"flowExecutor"</span>/&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"flowRequestUrlHandler"</span>&gt;
        &lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.context.servlet.WebFlow1FlowUrlHandler"</span>/&gt;
    &lt;<span class="hl-tag">/property</span>&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
			</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-config-view-resolver"></a>15.3.5.&nbsp;View Resolution</h3></div></div></div><p>
				Web Flow 2 by default will both select and render views.
				View were previously selected by Web Flow 1 and then rendered by an external view resolver.
			</p><p>
				In order for version 1 flows to work in Web Flow 2 the default view resolver must be overridden.
				A common use case is to use <a class="ulink" href="http://tiles.apache.org/" target="_top">Apache Tiles</a> for view resolution.
				The following configuration will replace the default view resolver with a Tiles view resolver.
				The <code class="code">tilesViewResolver</code> in this example can be replaced with any other view resolver.
			</p><pre class="programlisting">
&lt;<span class="hl-tag">webflow:flow-registry</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowRegistry"</span> <span class="hl-attribute">flow-builder-services</span>=<span class="hl-value">"flowBuilderServices"</span>&gt;
	&lt;<span class="hl-tag">web:flow-location</span> <span class="hl-attribute">path</span>=<span class="hl-value">"..."</span> /&gt;
    ...
&lt;<span class="hl-tag">/webflow:flow-registry</span>&gt;

&lt;<span class="hl-tag">webflow:flow-builder-services</span> <span class="hl-attribute">id</span>=<span class="hl-value">"flowBuilderServices"</span> 
                               <span class="hl-attribute">view-factory-creator</span>=<span class="hl-value">"mvcViewFactoryCreator"</span>/&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"mvcViewFactoryCreator"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.webflow.mvc.builder.MvcViewFactoryCreator"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewResolvers"</span> <span class="hl-attribute">ref</span>=<span class="hl-value">"tilesViewResolver"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">"tilesViewResolver"</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"viewClass"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles.TilesJstlView"</span>/&gt;
&lt;<span class="hl-tag">/bean</span>&gt;

&lt;<span class="hl-tag">bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">"org.springframework.web.servlet.view.tiles.TilesConfigurer"</span>&gt;
    &lt;<span class="hl-tag">property</span> <span class="hl-attribute">name</span>=<span class="hl-value">"definitions"</span> <span class="hl-attribute">value</span>=<span class="hl-value">"/WEB-INF/tiles-def.xml"</span> /&gt;
&lt;<span class="hl-tag">/bean</span>&gt;
			</pre></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="upgrade-guide-webflow-concepts"></a>15.4.&nbsp;New Web Flow Concepts</h2></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-concepts-binding"></a>15.4.1.&nbsp;Automatic Model Binding</h3></div></div></div><p>
				Web Flow 1 required Spring MVC based flows to manually call <code class="code">FormAction</code> methods, notably:
				<code class="code">setupForm</code>, <code class="code">bindAndValidate</code> to process form views.
				Web Flow 2 now provides automatic model setup and binding using the <code class="code">model</code> attribute for <code class="code">view-state</code>s.
				Please see the <a class="link" href="#view-model" title="4.6.&nbsp;Binding to a model">Binding to a Model</a> section for details.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-concepts-el-v-ognl"></a>15.4.2.&nbsp;OGNL vs EL</h3></div></div></div><p>
				Web Flow 1 used OGNL exclusively for expressions within the flow definitions.
				Web Flow 2 adds support for Unified EL.
				United EL is used when it is available, OGNL will continue to be used when a Unified EL implementation is not available.
				Please see the <a class="link" href="#el" title="3.&nbsp;Expression Language (EL)">Expression Language</a> chapter for details.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-concepts-flash-scope"></a>15.4.3.&nbsp;Flash Scope</h3></div></div></div><p>
				Flash scope in Web Flow 1 lived across the current request and into the next request.
				This was conceptually similar to Web Flow 2's view scope concept, but the semantics were not as well defined.
				In Web Flow 2, flash scope is cleared after every view render.
				This makes flashScope semantics in Web Flow consistent with other web frameworks.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-concepts-jsf"></a>15.4.4.&nbsp;Spring Faces</h3></div></div></div><p>
				Web Flow 2 offers significantly improved integration with JavaServerFaces.
				Please see the <a class="link" href="#spring-faces" title="12.&nbsp;JSF Integration">JSF Integration</a> chapter for details.
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="upgrade-guide-webflow-concepts-redirects"></a>15.4.5.&nbsp;External Redirects</h3></div></div></div><p>
				External redirects in Web Flow 1 were always considered context relative.
				In Web Flow 2, if the redirect URL begins with a slash, it is considered servlet-relative instead of context-relative.
				URLs without a leading slash are still context relative.
			</p></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="field-mappings"></a>Appendix&nbsp;A.&nbsp;Flow Definition Language 1.0 to 2.0 Mappings</h2></div></div></div><p>
		The flow definition language has changed since the 1.0 release.
		This is a listing of the language elements in the 1.0 release, and how they map to elements in the 2.0 release.
		While most of the changes are semantic, there are a few structural changes.
		Please see the upgrade guide for more details about changes between Web Flow 1.0 and 2.0. 
	</p><div class="table"><a name="field-mappings-table"></a><p class="title"><b>Table&nbsp;A.1.&nbsp;Mappings</b></p><div class="table-contents"><table summary="Mappings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col><col><col><col><col></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						SWF 1.0
					</th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						SWF 2.0
					</th><th style="border-bottom: 0.5pt solid ; ">
						Comments
					</th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						method
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>action-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>argument</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate expression="func(arg1, arg2, ...)"/&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						parameter-type
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>attribute-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						input and output elements can be in flows or subflows directly
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td style="">
						now subflow-attribute-mapper attribute on subflow-state
					</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>bean-action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						method
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>decision-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>decision-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-end</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>end-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						commit
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>entry-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-entry</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluate-action</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluate</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						expression
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate ...&gt; &lt;attribute name=&#8221;name&#8221; value="..." /&gt; &lt;/evaluate&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						result
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						result-type
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>evaluation-result</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate result="..." /&gt; 
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exception-handler</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exception-handler</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>exit-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-exit</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>flow</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>flow</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						start-state
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						abstract
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>global-transitions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>global-transitions</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>if</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>if</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						test
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						test
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						then
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						then
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						else
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						else
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>import</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>bean-import</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						resource
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						resource
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>inline-flow</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						convert to new top-level flow
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input-attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;input name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="">
						inputs can be in flows and subflows directly
					</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>mapping</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>input or output</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						source
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name or value
					</td><td style="border-bottom: 0.5pt solid ; ">
						name when in flow element, value when in subflow-state element
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						target
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name or value
					</td><td style="border-bottom: 0.5pt solid ; ">
						value when in flow element, name when in subflow-state element
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						target-collection
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						no longer supported
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						from
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						detected automatically
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>method-argument</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="">
						use &lt;evaluate expression="func(arg1, arg2, ...)"/&gt;
					</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>method-result</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;evaluate result="..." /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output-attribute</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;output name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						required
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>output-mapper</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="">
						output can be in flows and subflows directly
					</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>render-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-render</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>set</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>set</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						attribute
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						prefix name with scope &lt;set name="flowScope.foo" /&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						value
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						use &lt;set ...&gt; &lt;attribute name=&#8221;name&#8221; value="..." /&gt; &lt;/set&gt;
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						type
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>start-actions</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>on-start</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>start-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-bottom: 0.5pt solid ; ">
						now &lt;flow start-state="..."&gt;, or defaults to the first state in the flow
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						idref
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>subflow-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>subflow-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						flow
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						subflow
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						subflow-attribute-mapper
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>transition</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>transition</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on-exception
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						on-exception
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						to
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						bind
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>value</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>value</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>var</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>var</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						name
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						class
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						class
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						scope
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td style="border-bottom: 0.5pt solid ; ">
						always flow scope
					</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						bean
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td style="">
						all Spring beans can be resolved with EL
					</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>view-state</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>view-state</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						id
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						view
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						parent
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						redirect
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						popup
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						model
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						history
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>persistence-context</em></span>
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>render</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						fragments
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>*</em></span>
					</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " colspan="2">
						<span class="emphasis"><em>secured</em></span>
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; ">
						attributes
					</td><td class="auto-generated" style="border-bottom: 0.5pt solid ; ">&nbsp;</td></tr><tr><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						*
					</td><td class="auto-generated" style="border-right: 0.5pt solid ; ">&nbsp;</td><td style="border-right: 0.5pt solid ; ">
						match
					</td><td class="auto-generated" style="">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"></div></div></body></html>